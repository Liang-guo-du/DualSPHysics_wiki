## Visualization of particle output data
The PartVTK code is used to convert the output binary files of DualSPHysics into
different formats that can be visualised and /or analysed. Thus, the output files of
DualSPHysics, the binary files (.bi4), are now the input files for the post-processing
code PartVTK.

<p align="center">
<img src="https://i.imgur.com/drv1pWQ.png"/>
</p>

<p align="center">
<strong>Figure 11-1.</strong> Input (red) and output (blue) files of PartVTK code.
</p>

The output files can be VTK-binary (-savevtk), CSV (-savecsv) or ASCII (-saveascii). In
this way the results of the simulation can be plotted using Paraview, gnuplot, Octave,
etc.... For example; PartVtkBin_0000.vtk,... These files can be generated by selecting a
set of particles defined by mk (-onlymk:), by the id of the particles (-onlyid:), by the type
of the particle (-onlytype:), by the position of the particles (-onlypos: and -onlyposfile) or by
the limits of velocity of the particles (-onlyvel:), so we can check or uncheck all the
particles (+/-all), the boundaries (+/-bound), the fixed boundaries (+/-fixed), the moving
boundaries (+/-moving), the floating bodies (+/-floating) or the fluid particles (+/-fluid).
The output files can contain different particle data (-vars:); all the physical quantities (+/-
all), velocity ( +/-vel), density ( +/-rhop), pressure ( +/-press), mass (+/-mass), volume (+/-vol),
acceleration (+/-ace), vorticity ( +/-vor), the id of the particle (+/-idp), the mk of the
particle (+/-mk) and the type (+/-type:). The user can define new variables in
DualSPHysics and make reference to those in PartVTK using -vars:NewVar or -vars:all.

In addition, the PartVTKOut code is used to generate files with the particles that were
excluded from the simulation (stored in PartOut.obi4). The output file of
DualSPHysics, PartOut.obi4 is the input file for the post-processing code
PartVTKOut. Information with excluded particles can be stored in CSV files ( -savecsv:
-SaveResume) and VTK (-savevtk:) can be generated with those particles.

<p align="center">
<img src="https://i.imgur.com/26meW14.png"/>
</p>

<p align="center">
<strong>Figure 11-2.</strong> Input (red) and output (blue) files of PartVTKOut code.
</p>

Particles can be excluded from the simulation for three reasons:
* Position: Limits of the domain are computed starting from particles that were
created in GenCase. Note that these limits are different from pointmin and pointmax
defined in section <definition> of the input XML and can be also changed by the
user when executing DualSPHysics code. The actual limits of the domain can be
seen in Run.out: MapRealPos(final). Therefore, when one particle moves beyond
those limits, the particle is excluded. Only in the Z+ direction, can particles move to
higher positions according to parameter IncZ., where new cells are created to contain
the particles.

* Position: Valid values of particle density are between RhopOutMin (default=700)
and RhopOutMax (default=1300), but the user can also change those values.

* Velocity: One particle can be also removed from the system when its
displacement exceeds 0.9*Scell during one time step (Scell is the size of the cell).

## Visualization of boundaries
In order to visualise the boundary shapes formed by the boundary particles, different
geometry files can be generated using the BoundaryVTK code. The code creates
triangles or planes to represent the boundaries.

As input data, shapes can be loaded from a VTK file (-loadvtk), a PLY file (-loadply) or
an STL file (-loadstl) while boundary movement can be imported from an XML file (-
loadxml file.xml) using the timing of the simulation (-motiontime) or with the exact instants
of output data (-motiondatatime ). The movement of the boundaries can also be
determined starting from the particle positions ( -motiondata). The output files consist of
VTK files (-savevtk), PLY files (-saveply) or STL files (-savestl) with the loaded
information and the moving boundary positions at different instants. For example the
output files can be named motion_0000.vtk, motion_0001.vtk, motion_0002.vtk...
These files can be also generated by only a selected object defined by mk (-onlymk:), by
the id of the object (-onlyid:).

<p align="center">
<img src="https://i.imgur.com/8eGwVOr.png"/>
</p>

<p align="center">
<strong>Figure 11-3.</strong> Input (red) and output (blue) files of BoundaryVTK code.
</p>

## Analysis of numerical measurements

To compare experimental and numerical values, a tool to analyse these numerical
measurements is needed. The MeasureTool code allows different physical quantities at
a set of given points to be computed. The binary files (.bi4) generated by DualSPHysics
are the input files of the MeasureTool code and the output files are again VTK-binary
or CSV or ASCII. The numerical values are computed by means of an SPH
interpolation of the values of the neighbouring particles around a given position.

<p align="center">
<img src="https://i.imgur.com/wXuka6m.png"/>
</p>

<p align="center">
<strong>Figure 11-4.</strong> Input (red) and output (blue) files of MeasureTool code.
</p>

The interpolation is computed using the Wendland kernel. Kernel correction is also
applied when the summation of the kernel values around the position is higher than a
value (-kclimit:) defining a dummy value if the correction is not applied ( -kcdummy:).
The positions where the interpolation is performed are given in a text file for fixed
position (-points <file> ) or with position that changes in time (-pointspos <file>). Variables
can be also computed at the position of existing particles with a given mk ( -particlesmk:)
or by indicating their id (-particlesid: ). The distance of interpolation can be 2h (the size
of the kernel) or can be changed (-distinter_2h:, -distinter:). The interpolation is carried
out using a selected set of particles, so the same commands for PartVTK can be used ( -
onlymk: , -onlyid:, -onlytype:, -onlypos:, -onlyposfile). Different interpolated variables (-vars)
can be numerically calculated; all available ones (+/-all), velocity ( +/-vel), density (+/-
rhop), pressure (+/-press), mass (+/-mass), volume (+/-vol), id (+/-idp), vorticity ( +/-vor),
acceleration (+/-ace) the summation of the kernel multiplied by volume ( +/-kcorr), and
variables defined by the user (+/-XXX). The maximum water depth can be also
computed. Height values (-height:) are calculated according to the interpolated mass, if
the nodal mass is higher than a given reference mass, that Z-position will be considered
as the maximum height. The reference value can be calculated in relation to the mass
values of the selected particles (-height:0.5 , half the mass by default in 3D and -height:0.4
in 2D) or can be given in an absolute way (-heightlimit:).

## Force computation

The ComputeForces code is employed to compute the force exerted by the fluid onto a
boundary object. The value of force is calculated as the summation of the acceleration
values (solving the momentum equation) multiplied by the mass of each boundary
particle (see also PostprocessingCalculations.pdf).

<p align="center">
<img src="https://i.imgur.com/qJaDZC0.png"/>
</p>

<p align="center">
<strong>Figure 11-5.</strong> Input (red) and output (blue) files of ComputeForces code.
</p>

The momentum equation to solve the acceleration values is computed using the
Wendland kernel. The distance of interpolation can be 2h (the size of the kernel) or can
be changed (-distinter_2h:, -distinter:). The interpolation is carried out using a selected set
of particles, so the same commands for PartVTK can be used (-onlymk:, -onlyid:, -
onlypos:). The output files can be VTK-binary (-savevtk ), CSV (-savecsv) or ASCII (-
saveascii).

## Analysis of floating data

The FloatingInfo code is employed to obtain different data of the floating objects such
as linear velocity, angular velocity, displacement of the center, motions and angles of
rotation. The binary files (.bi4) generated by DualSPHysics and the file PartFloat.fbi4
are the input files of the FloatingInfo code and the output files are CSV files.

<p align="center">
<img src="https://i.imgur.com/66NLo9x.png"/>
</p>

By default, the code always saves time, fvel (linear velocity), fomega (angular velocity),
center. Motions and rotation can be also obtained (-savemotion) in 2D (surge, heave, roll)
and in 3D (surge, sway, heave, roll, pitch, yaw). A CSV file will be created with the
information of each floating in the simulation, but user can choose a given floating
object (-onlymk:) or the name of the file (-savedata).

## Surface representation

Using a large number of particles, the visualization of the simulation can be improved
by representing surfaces instead of particles. To create the surfaces, the marching cubes
algorithm is used [Lorensen and Cline, 1987]. This computer graphics technique
extracts a polygonal mesh (set of triangles) of an isosurface from a 3-D scalar field.

Figure 11-6, represents a 3-D dam-break simulation using 300,000 particles. The first
snapshot shows the particle representation. Values of mass are interpolated at the nodes
of a 3-D Cartesian mesh that covers the entire domain using an SPH interpolation. Thus
a 3-D mesh vertex that belongs to the free surface can be identified. The triangles of this
surface (generated by means of the marching cubes algorithm) are represented in the
second frame of the figure. The last snapshots correspond to the surface representation
where the colour corresponds to the interpolated velocity value of the triangles.

<p align="center">
<img src="https://i.imgur.com/F4iYF3e.png"/>
</p>

<p align="center">
<strong>Figure 11-6.</strong> Conversion of points to surfaces.
</p>

The output binary files of DualSPHysics are the input files of the IsoSurface code and
the output files are VTK files (-saveiso[:<var>]) with the isosurfaces calculated using a
variable (<var>) or can be structured points (-savegrid) with data obtained after the
interpolation. The Cartesian mesh size can be defined by specifying the discretisation
size using either the particle size dp (-distnode_dp: ) or by specifying an absolute
internode distance (-distnode:). On the other hand, the maximum distance for the
interaction between particles to interpolate values on the nodes can be also defined
depending on 2h (-distinter_dp:) or in an absolute way ( -distinter:). The particles to be
considered to create the isosurface can be defined by the user using positions (-onlypos &
-onlyposfile) or the limits of the isosurface can be indicated (-iso_limits:)

<p align="center">
<img src="https://i.imgur.com/6up41fi.png"/>
</p>

<p align="center">
<strong>Figure 11-7.</strong> Input (red) and output (blue) files of IsoSurface code.
</p>

