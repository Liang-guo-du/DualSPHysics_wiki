Some demonstration cases are included in the DualSPHysics package (Figure 12.1); such as a dam break interacting with an obstacle in a tank, waves on a beach created by a piston or the real geometry of a pump mechanism that translates water within a storage tank.

<p align="center">
<img src="https://imgur.com/ko8d0Rh.png" />
</p>

<p align="center">
<strong>Figure 12-1.</strong> Test cases: dambreak, wavemaker, and pump.
</p>

The different test cases are described in the following sections. The scripts (_.bat_ in Windows and _.sh_ in Linux) are presented and the different command line instructions to execute the different programs are described. The XML files are also explained in detail to describe the execution parameters and the different labels to plot boundaries, fluid volumes, movements, etc. 

For each case there are 4 options; 
* wCase_win64_CPU.bat (windows on CPU)
* wCase_win64_GPU.bat (windows on GPU)
* xCase_linux64_CPU.sh (linux on CPU)
* xCase_linux64_GPU.sh (linux on GPU)

Since many 3-D applications can be reduced to a 2-D problem, the executable of DualSPHysics can also perform 2-D simulations, however this option is not fully optimized. A 2-D simulation can be achieved easily by imposing the same values in the Y-direction (`<pointmin>` = `<pointmax>` in the input XML file). For example, see the two-dimensional 01_DamBreak indicated in Figure 12-2. Thus, the initial configuration is a 2-D system and DualSPHysics will detect automatically that the simulation must be carried out using the 2-D formulation.

## 12.1 MAIN EXAMPLES
 
The different CASES provided are intended as worked examples for users to create their own cases, to learn the different available options and what post-processing tools can be used. The following list summarises the testcases that can be found in **examples/main**:

01_DAMBREAK
* 3-D dam break flow impacting on a structure: numerical velocity, pressure and force are computed.
* 2-D dam break and validation data from [Koshizula and Oka, 1996] experiment.

02_PERIODICITY
* 2-D case with Periodicity in X direction. 
Delta-SPH is also used.

03_MOVINGSQUARE
* 2-D case with square that moves with rectilinear movement.
Example of no gravity so parameter “b” needs to be specified by the user. 
Shifting is used for this internal flow (no need to detect free surface).

04_EXTERNALFORCES
* External acceleration is loaded from a file and applied to two different volumes of fluid.
Delta-SPH is also used.

05_SLOSHINGTANK
* 2-D sloshing tank that reads external acceleration from a file.
* 2-D sloshing tank that reads the rotational movement of the tank itself from a file.
Validation with SPHERIC Benchmark #10 where pressure is computed.

06_WAVEMAKER
* 3-D tank with Periodicity in Y direction and piston with sinusoidal movement. 
Delta-SPH and Shifting are used.

07_WAVEMAKERFILE
* 2-D tank with piston motion loaded from external file and external structure (STL).  
Validation data from CIEMito experiment: numerical computation of wave surface elevation and force exerted onto the wall.

08_WAVESFLAP
* 2-D regular waves generated with flap and comparison with 2nd order wave theory (beach).
* 2-D irregular waves generated with flap and comparison with 2nd order wave theory (beach).

09_WAVESPISTON
* 2-D regular waves with piston and comparison with 2nd order wave theory (beach & damping).
* 2-D irregular waves with piston and comparison with 2nd order wave theory (beach & damping).

10_WAVESPISTONAWAS
* 2-D regular waves generated with piston interacting with a vertical wall with and without AWAS
* 2-D regular waves generated with piston interacting with a trapezoidal dike with and without AWAS
Forces against the wall and dike with and without AWAS are compared.
Overtopping in the case of dike with and without AWAS is also compared.

 
11_FLOATING
* 3-D floating box in a wave tank with Periodicity in Y direction and piston with sinusoidal movement. Delta-SPH is used.
* 2-D falling sphere that uses laminar+SPS viscosity. Validation data from [Fekken, 2004] and [Moyo and Greenhow, 2000].

12_FLOATINGWAVES
* 2-D floating box under the action of non-linear waves in a tank with flap that reads rotational motion from an external file and uses laminar+SPS viscosity. 
Validation data (motions of the box) from [Hadzic et al., 2005].
* 2-D floating box under the action of regular waves in a tank with piston. 
Validation data (motions of the box) from [Ren et al., 2015].

13_PUMP
* 3-D external geometries are imported (STL) and filling algorithm is used.
Rotational movement is imposed.

14_DEM
* 2-D case only with DEM of a ball that impacts with blocks. Example without fluid particles.
* 3-D dam-break and blocks where interaction between blocks and with walls used DEM and properties of materials. Delta-SPH is also used.
* 2-D case with 2000 floating objects that interact in terms of DEM approach.

15_POISEUILLE
* 2-D case of Poiseuille flow with laminar+SPS viscosity and using high resolution 

**12.1.1 DAMBREAK**

A 2-D dam break can be executed using _wCaseDambreakVal2D_win64_GPU.bat_ (_xCaseDambreakVal2D_linux64_GPU.sh_ in linux), which is the file that summarises the tasks to be carried out using the different codes in a given order: 

<p align="center">
<img src="https://i.imgur.com/1geUGm8.png" />
</p>

Figure 12-2 shows different instants of the CaseDambreakVal2D simulation. The left frames show the PartFluid_xxxx.vtk (computed with **PartVTK**) and the right ones show the Slices_xxxx.vtk (obtained with **IsoSurface**) 

<p align="center">
<img src="https://i.imgur.com/Xw77I5u.png" />
</p>

<p align="center">
<strong>Figure 12-2.</strong> Instants of the CaseDambreakVal2D simulation. Colour represents velocity of the particles.
</p>

With this example, the experimental data of [Koshizuka and Oka, 1996] can be numerically reproduced. The file _EXP_X-DamTipPosition_Koshizula&Oka1996.txt_ includes the X-position of the tip of the dam for several instants (before the impact with the other wall).  

Numerical gauges (`<gauges>`) allows the user to compute different magnitudes during the execution of DualSPHysics. In this case, two gauges were created at x=0.2 to compute the water column height evolution and at z=0.03 to compute the X-position of the tip of the dam. The gauges can be also observed in the right panel of Figure 12-2.

The 3-D test case consists of a dam-break flow impacting with a structure inside a numerical tank. No moving boundary particles are involved in this simulation and no movement is defined. This case is executed using _wCaseDambreak_win64_GPU.bat_ (_xCaseDambreak_linux64_GPU.sh_ in linux),

Different instants of the CaseDambreak simulation are shown in Figure 12-3 where the _PartFluid_xxxx.vtk_ of the fluid particles, the _CaseDambreak_Box_Dp.vtk_ and _CaseDambreak_Building_Dp.vtk_ are depicted. 

<p align="center">
<img src="https://i.imgur.com/VmJoCXu.png" />
</p>

<p align="center">
<strong>Figure 12-3.</strong> Instants of the CaseDambreak simulation visualized using Paraview. Colour represents velocity of the particles.
</p>

Using **MeasureTool** code, numerical velocities have been computed in the list of points described in the file **CaseDambreak_PointsVelocity.txt**, which are (0.754, 0.31, 0.02), (0.754, 0.31, 0.04) and (0.754, 0.31, 0.06) using information of fluid particles within the kernel interaction. Numerical values of Vx-velocity in the x-direction are shown in Figure 12-4 for these three points.

<p align="center">
<img src="https://i.imgur.com/rXF6fbH.png" width="450px" />
</p>

<p align="center">
<strong>Figure 12-4.</strong> Numerical velocity computed at three different locations.
</p>

Pressure values are also computed using **MeasureTool** in the list of points described in the file _CaseDambreak_PointsPressure.txt_, which corresponds to locations in the front wall of the structure (Figure 12-5) using information of fluid particles within the kernel interaction. Due to the use of the dynamic boundaries, probes used for measuring quantities should not be placed at the exact position of boundary particles. The forces exerted by the boundary particles create a small gap between them and fluid particles (1.5 times _h_); as a result, probes placed inside the gap will have a reduced fluid particle population and will produce either an incorrect or no result. To avoid this issue, it is proposed that probes are placed at a distance 1.5h from the boundary positions.

In this example, the _PointsPressure_Incorrect_ probes are placed at the exact position as the boundary particles at the building, while the _PointsPressure_Correct_ probes are placed at a distance of 1.5_h_ (for the default conditions and parameters of the case) from the boundaries. The first probes produce no pressure results as the number of fluid particles for the interpolation is too small, while the second shows the pressure impact by the water flow. 

<p align="center">
<img src="https://i.imgur.com/QaXHq6U.png" />
</p>

<p align="center">
<strong>Figure 12-5.</strong> Position of incorrect (red) and correct (green) pressure probes in CaseDambreak.
</p>

Note that the probes are not automatically associated with the smoothing length _h_ and their position has to be changed manually if the resolution changes. Also, note that by increasing resolution (i.e. using a smaller “dp”) the gap is reduced.
 
Figure 12-6 shows the pressure computed at the correct numerical probes.  

<p align="center">
<img src="https://i.imgur.com/Pn96uAP.png" width="450px"/>
</p>

<p align="center">
<strong>Figure 12-6.</strong> Pressure values computed at different locations in CaseDambreak.
</p>

This case also shows how to compute forces exerted against a structure. In this way the force is computed using **ComputeForces** as the summation of the acceleration values of the boundary particles that form the front wall of the structure (mk=21) multiplied by mass. Figure 12-7 shows the time series of the numerical force.

<p align="center">
<img src="https://i.imgur.com/l9pSnE9.png" width="450px"/>
</p>

<p align="center">
<strong>Figure 12-7.</strong> Force (X-component) exerted on the front wall of the structure in CaseDambreak. 
</p>

In fact, the methodology outlined here was used in for the validation of DualSPHysics presented in [Crespo et al. (2011)].

Finally, an example to use **FlowTool** is also available in CaseDambreak. Two different domains are defined in the text file _CaseDambreak_FileBoxes.txt_. Figure 12-8 shows the red domain (RESERVOIR) where the water reservoir was initially created and the green box (TANK) to compute the flow rate in front of the obstacle.  The output VTK files named _Boxes_xxxx.vtk_ are also depicted in Figure 12-8 and the colour corresponds to the domain to which they belong.

<p align="center">
<img src="https://i.imgur.com/oJdCzQF.png" />
</p>

<p align="center">
<strong>Figure 12-8.</strong> Domains to compute flow in CaseDambreak; RESERVOIR (red) and TANK (green).
</p>

**FlowTool** also creates a CSV file, named ResultFlow.csv. Hence, figure 12-9 represents the outflow of the red domain and the inflow into the green one. 

<p align="center">
<img src="https://i.imgur.com/guTFz1S.png" width="450px"/>
</p>

<p align="center">
<strong>Figure 12-9.</strong> Outflow in the domain RESERVOIR and inflow in the domain TANK.
</p>

**12.1.2 PERIODICITY**

This testcase is an example of periodicity applied to 2-D case where particles that leave the domain through the right wall are introduced through the left wall with the same properties but where the vertical position can change (with an increase of +0.3 in Z-position). _wCasePeriodicity.bat_ (_xCasePeriodicity.sh_ in linux) file summarises the tasks to be carried out using the different codes.

Different instants of the CasePeriodicity simulation are shown in Figure 12-10 where the _PartFluid_xxxx.vtk_ of the fluid particles and the _CasePeriodicity_Bound.vtk_ are depicted.

<p align="center">
<img src="https://i.imgur.com/kPMJKkX.png" />
</p>

<p align="center">
<strong>Figure 12-10.</strong> Different instants of the CasePeriodicity simulation. Colour represents Id of the fluid particles.
</p>

**12.1.3 MOVINGSQUARE**

A 2-D case without gravity is simulated. A square box is moving with uniform velocity (`<mvrect>`) inside the numerical tank – [see SPHERIC Benchmark #2](http://spheric-sph.org/tests/test-6). Gravity is set to zero, which means that parameter “b” cannot be automatically computed following equation of state (Eq. 14) and needs to be specified in `<constantsdef>` (`<b value="1.1200e+05" auto="false" />`).  The value of “b” is chosen to ensure that the speed of sound, cs, is at least 10 times the maximum particle velocity to maintain weak compressibility, that is vmax, cs ≥ 10 vmax.  Shifting is used for this internal flow to prevent the appearance of voids in the fluid. The case can be also executed without applying shifting to observe the problem of the voids.

_wCaseMovingSquare.bat_ (_xCaseMovingSquare.sh_ in linux) file summarises the tasks to be carried out using the different codes. The same case but without using shifting can be also executed to observe how the voids behind the moving object are not avoided if shifting is not applied.

Different instants of the CaseMovingSquare simulation are shown in Figure 12-11 where the _PartFluid_xxxx.vtk_ of the fluid particles and the _Square_xxxx.vtk_ are depicted.

<p align="center">
<img src="https://imgur.com/kU6cZDu.png" />
</p>

<p align="center">
<strong>Figure 12-11.</strong> Different instants of the CaseMovingSquare simulation. Colour represents the velocity of the fluid.
</p>

**12.1.4 EXTERNALFORCES**

This is a testcase where external forces are applied to the system. The external forces can be loaded from the files _CaseForcesData_0.csv_ and _CaseForcesData_1.csv_. 

_wCaseForces.bat_ (_xCaseForces.sh_ in linux) file summarises the tasks to be carried out using the different codes.

Figure 12-12 shows the external forces that will be applied to the fluid particles inside the numerical tank. This mimics the effect of a box being accelerated in one direction and rotating around the y-axis.

<p align="center">
<img src="https://i.imgur.com/Wj5APtu.png" />
</p>

<p align="center">
<strong>Figure 12-12.</strong> External forces applied to the fluid particles in CaseForces.
</p>

Different instants of the simulation can be observed in Figure 12-13 where the _PartFluid_xxxx.vtk_ of the fluid particles and the file _CaseForces_Dp.vtk_ are depicted. The colours of the fluid particles correspond to the two different MK values.

<p align="center">
<img src="https://i.imgur.com/Avrz1s4.png" />
</p>

<p align="center">
<strong>Figure 12-13.</strong> Different instants of the CaseForces simulation.
</p>

**12.1.5 SLOSHINGTANK**

A 2-D sloshing tank is simulated in two different forms:
a)	CaseSloshingAcc: External acceleration is loaded from the CSV file _CaseSloshingAccData.csv_ and applied to the fluid particles.
b)	CaseSloshingMotion: Rotational movement is applied to the tank using prescribed rotation defined in the text file _CaseSloshingMotionData.dat_ (`<mvrotfile>`) that contains time and degrees (as shown in Figure 12-14).

<p align="center">
<img src="https://imgur.com/OWRnNrM.png" width="450px"/>
</p>

<p align="center">
<strong>Figure 12-14.</strong> Rotation movement prescribed in file CaseSloshingMotion.dat. 
</p>

_wCaseSloshing.bat_ (_xCaseSloshing.sh_ in linux) file summarises the tasks to be carried out using the different codes for the two cases. Different instants of the simulation can be observed in Figure 12-15 where the files _PartAll_xxxx.vtk_ are depicted.

<p align="center">
<img src="https://i.imgur.com/PavVrvM.png" />
</p>

<p align="center">
<strong>Figure 12-15.</strong> Different instants of the CaseSloshingMotion simulation. Colour represents the velocity of the fluid.
</p>

Validation with [SPHERIC Benchmark #10](http://spheric-sph.org/tests/test-10) is also included. Experimental pressure is available in _EXP_Pressure_SPHERIC_Benchmark#10.txt_. Numerical pressures are computed using _MeasureTool_ in both cases. CaseSloshingAcc reads a text file with the fixed position (-0.45, 0, 0.093) while CaseSloshingMotion reads a CSV file with the position of the sensor at each time since the point to measure also moves with the tank. 

Hence, numerical pressure is computed at the location of the experimental sensor (_PointsPressure_Incorrect_) and at a distance of 1.5h from the boundaries (_PointsPressure_Correct_) as shown in Figure 12-16. The first probe produces no pressure results as the number of fluid particles for the interpolation is too small, while the second shows the pressure impact by the water flow. 

<p align="center">
<img src="https://i.imgur.com/g1gcfeg.png" width="450px"/>
</p>

<p align="center">
<strong>Figure 12-16.</strong> Position of incorrect and correct pressure probes in CaseSloshing.
</p>

Note that the probes are not automatically associated with the smoothing length _h_ and their position has to be changed manually if the resolution (or particle size “dp”) changes. Also, note that by increasing resolution the gap is reduced. Using **BoundaryVTK**, the user can compute the time history of the position of the moving point initially at 1.5_h_ of the wall to obtain new positions to be used with **MeasureTool**.

Figure 12-17 shows the numerical pressure computed using **MeasureTool** in both cases and compared with the experimental signal. Results improve using higher resolution than the one used here.

<p align="center">
<img src="https://i.imgur.com/v2UUaA4.png" width="450px"/>
</p>

<p align="center">
<strong>Figure 12-17.</strong> Experimental and numerical pressure at Sensor1 in CaseSloshing.
</p>

**12.1.6 WAVEMAKER**

CaseWavemaker simulates several waves breaking on a numerical beach. A wavemaker is performed to generate and propagate the waves. In this testcase, a sinusoidal movement (`<mvrectsinu>`) is imposed to the boundary particles of the wavemaker and Periodicty in Y direction is also used. _wCaseWavemaker.bat_ (_xCaseWavemaker.sh_ in linux) file describes the execution task to be carried out in this directory.

The files _MotionPiston_xxxx.vtk_ containing the position of the wavemaker at different instants and _Surface_xxxx.vtk_ containing the surface representation are used to display the results in Figure 12-18:

<p align="center">
<img src="https://i.imgur.com/C6NFNeY.png" />
</p>

<p align="center">
<strong>Figure 12-18.</strong> Different instants of the CaseWavemaker simulation. Colour represents surface velocity.
</p>

Using the **MeasureTool** code, numerical wave elevations have been computed in the list of points described in the file _CaseWavemaker_PointsHeights.txt_. So that, _PointsHeights_h_xxxx.vtk_ are now depicted in Figure 12-19.

<p align="center">
<img src="https://i.imgur.com/P7jJVhO.png" />
</p>

<p align="center">
<strong>Figure 12-19.</strong> Different instants of the CaseWavemaker simulation. Colour represents wave elevation.
</p>

**MeasureTool** is also used to compute the wave elevation at one wave gauge located at x=1, y=1 (_CaseWavemaker_wg0_3D.txt_) and the output result can be analysed in _WG0_Height.csv_.

**12.1.7 WAVEMAKERFILE**

This 2-D case aims to mimic an experiment performed in [CIEMito wave flume](http://ciemlab.upc.edu/en/facilities/ciemito) at the Universitat Politècnica de Catalunya (UPC) in Barcelona. The movement of the piston is prescribed in the file _CaseWavemaker2D_Piston_Movement.dat_ (`<mvfile>`) and an external structure is loaded (_CaseWavemaker2D_Structure.stl_). 

The _wCaseWavemaker2D.bat_ (_xCaseWavemaker2D.sh_ in linux) file describes the execution tasks to be carried out in this directory.  

Different instants of the CaseWavemaker2D simulation are shown in Figure 12-20 where the _PartFluid_xxxx.vtk_ of the fluid particles and the _PartMoving_xxxx.vtk_ of the piston are depicted.

<p align="center">
<img src="https://i.imgur.com/8mtFGqH.png" />
</p>

<p align="center">
<strong>Figure 12-20.</strong> Different instants of the CaseWavemaker2D simulation. The three black dots represent the wave gauges _wg1, wg2, wg3_ used for validation. Colour represents the horizontal velocity of the fluid.
</p>

This case also includes validation data from the CIEMito experiment: wave surface elevation at different locations (_CaseWavemaker2D_wg1_2D.txt_, _CaseWavemaker2D_wg2_2D.txt_ and _CaseWavemaker2D_wg3_2D.txt_) and force exerted onto the right wall. 

Figure 12-21 shows the experiment and numerical time series of wave surface elevation at wg1 obtained using **MeasureTool**.

<p align="center">
<img src="https://imgur.com/KnBP8Ov.png" width="550px"/>
</p>

<p align="center">
<strong>Figure 12-21.</strong> Numerical and experimental wave elevation at wg1 in CaseWavemaker2D.
</p>

This case also computes forces exerted against the structure in the final of the tank. The force is computed using ComputeForces as the summation of the acceleration values of the boundary particles that form the front wall (id:1616-1669) multiplied by mass. Figure 12-22 shows the time series of the numerical force. Note that initial hydrostatic force is 20.72 N (the initial depth in front of the wall is 0.065 m)

<p align="center">
<img src="https://i.imgur.com/yr9eedq.png" width="450px"/>
</p>

<p align="center">
<strong>Figure 12-22.</strong> Force (X-component) exerted on the right wall in CaseWavemaker2D.
</p>

**12.1.8 WAVESFLAP**

Several examples of automatic generation of waves are included in the new package: monochromatic (regular) waves and irregular waves are generated using flap- and piston-type wavemakers. 

Second-order waves are simulating (Figure 12-23), corresponding to results shown in [Altomare et al., 2017]. The wave height, wave period, water depth at wave generation, wave steepness and wavelength are summarised in the following table. The quantities _H_ and _T_ refer to the wave height and wave period of the first-order component of the monochromatic waves; _Hm0_ and _Tp_ are the significant wave height and peak wave period of the irregular wave train, respectively.

<p align="center">
<img src="https://i.imgur.com/h9YXi4t.png" />
</p>

<p align="center">
<strong>Figure 12-23.</strong> Wave conditions on Le Mehaute abacus [Le Mehaute, 1976].
</p>

This first testcase includes wave generation using FLAP. 
_wCaseFlapBeach_REG.bat_ (_xCaseFlapBeach_REG.sh_ in linux) file describes the execution tasks to be carried out in this directory to create monochromatic waves (`<flap>`). In order to reproduce only incident waves, passive absorption is used here to prevent reflection. In this case the passive absorption consists of a dissipative beach at the end of the tank. 

Different instants of the CaseFlapBeach_REG simulation are shown in Figure 12-24 where the _PartFluid_xxxx.vtk_ of the fluid particles and the _PartFlap_xxxx.vtk_ of the flap are depicted.

<p align="center">
<img src="https://i.imgur.com/irqV5RH.png" />
</p>

<p align="center">
<strong>Figure 12-24.</strong> Different instants of the CaseFlapBeach_REG simulation. Colour represents the horizontal velocity of the fluid.
</p>

Numerical results using **MeasureTool** are compared with theoretical ones (that can also be computed by DualSPHysics using option `<savemotion>` in the XML configuration). Figure 12-25 shows the comparison of numerical water surface elevation measured (at a distance of 6 m of the piston) and numerical vertical and horizontal velocity (at 6 m of the piston and 0.26 m from still water level) with the theoretical results using second-order solutions. Note that numerical results agree with second-order theory, which validates the correct generation and propagation using DualSPHysics using flap.

<p align="center">
<img src="https://i.imgur.com/ByTvfB5.png" />
</p>

<p align="center">
<strong>Figure 12-25.</strong> Comparison between theoretical and numerical water surface elevation and orbital velocities for regular waves in CaseFlapBeach_REG.
</p>

The second case computes the movement of a piston to generate irregular. A pre-defined JONSWAP spectrum is used to characterised the irregular wave train in the frequency domain (`<flap_spectrum>`). 

_wCaseFlapBeach_IRREG.bat_ (_xCaseFlapBeach_IRREG.sh_ in linux) file describes the execution tasks to be carried out in this directory to create irregular random waves.

Figure 12-26 also shows the comparison of numerical wave surface elevation and horizontal velocity (obtained with **MeasureTool**) with the theoretical solution (using `<savemotion>`). Good agreement is also observed for irregular waves. Only first-order wave generation for irregular waves is implemented for flap-type wavemaker. Therefore, possible differences between the numerical and theoretical results are expected. Yet, in the case shown in Figure 12-26 these differences are negligible.

<p align="center">
<img src="https://i.imgur.com/Fgb2jsa.png" />
</p>

<p align="center">
<strong>Figure 12-26.</strong> Comparison between theoretical and numerical water surface elevation and orbital velocities for regular waves in CaseFlapBeach_IRREG.
</p>

The file “_CaseFlap_SPHvsTheory.ods_” includes all these comparisons.

**12.1.9 WAVESPISTON**

The same wave condition shown in Figure 12-23 is now created using a piston-type wavemaker. Regular (`<piston>`) and random (`<piston_spectrum>`) waves are created. Two different passive absorption systems are used to avoid reflection at the end of the tank; a dissipative beach and a sponge layer or damping (`<damping>`).
Therefore, different scripts can be used here:
* _wCasePistonBeach_REG.bat_ (_xCasePistonBeach_REG.sh_ in linux)
* _wCasePistonBeach_IRREG.bat_ (_xCasePistonBeach_IRREG.sh_ in linux)
* _wCasePistonDamping_REG.bat_ (_xCasePistonDamping_REG.sh_ in linux)
* _wCasePistonDamping_IRREG.bat_ (_xCasePistonDamping_IRREG.sh_ in linux)

Different instants of the CasePistonBeach_REG simulation are shown in Figure 12-27 where the _PartFluid_xxxx.vtk_ of the fluid particles and the _PartPiston_xxxx.vtk_ of the piston are depicted.

<p align="center">
<img src="https://i.imgur.com/QMxY7OD.png" />
</p>

<p align="center">
<strong>Figure 12-27.</strong> Different instants of the CasePistonBeach_REG simulation. Colour represents the horizontal velocity of the fluid.
</p>

Note how the same instants are shown in the images of Figure 12-27 (using piston) and the images of Figure 12-24 (using flap), and it can be observed how the same waves are created using both wavemakers. Figure 12-28 proves the similar behaviour of both passive absorption systems in the case of regular waves; dissipative beach and sponge layer (damping). Same behaviour is obtained for the irregular tests.

<p align="center">
<img src="https://i.imgur.com/2lZtWas.png" />
</p>

<p align="center">
<strong>Figure 12-28.</strong> Same instant of the CasePistonBeach_REG and CasePistonDamping_REG simulations. Colour represents the horizontal.
</p>

Figure 12-29 shows the comparison of numerical wave surface elevation measured (at a distance of 6 m of the piston) and numerical vertical and horizontal velocity (at 6 m of the piston and 0.26 m from still water level) with the theoretical result using second-order solutions for the case of regular waves. Note that numerical results agree with second-order theory, which validates the correct generation and propagation using DualSPHysics using piston (as shown in [Altomare et al., 2017]). 

<p align="center">
<img src="https://i.imgur.com/oAoSEUL.png" />
</p>

<p align="center">
<strong>Figure 12-29.</strong> Comparison between theoretical and numerical water surface elevation and orbital velocities for regular waves in CasePistonBeach_REG.
</p>

The file “CasePiston_SPHvsTheory.ods” includes more comparisons between the theoretical and numerical results for both regular and irregular waves and for both passive absorptions systems (beach and the sponge layer). Similar accuracy was obtained in all the cases. 

**12.1.10 WAVESPISTONAWAS**

This third cases focused on wave generation includes now the option of using Active Wave Absorption System (AWAS) that is only implemented for the piston-type wavemaker in DualSPHysics. 
The XML includes this option with `<piston>` or `<piston_spectrum>` using `<awas_zsurf>`

The AWAS system will absorb the reflected waves that impact with the numerical piston. Therefore, no passive absorption systems are used at the end of the tank because the aim is to absorb the reflected waves while the piston generates the incident ones.

A case with a vertical wall and other with a trapezoidal dike can be executed to analyse the effects of using AWAS. Therefore, different scripts can be used here:
* _wCasePistonWallAWAS_REG.bat_ (_xCasePistonWallAWAS_REG.sh_ in linux)
* _wCasePistonWallNoAWAS_REG.bat_ (_xCasePistonWallNoAWAS_REG.sh_ in linux)
* _wCasePistonDikeAWAS_REG.bat_ (_xCasePistonDikeAWAS_REG.sh_ in linux)
* _wCasePistonDikeNoAWAS_REG.bat_ (_xCasePistonDikeNoAWAS_REG.sh_ in linux)

In the cases with AWAS, incident and reflected wave are being propagated in the tank, however without AWAS also the re-reflected waves are included in the wave field. Re-reflected waves are those that, propagating backwards to the piston will be reflected by the piston surface and will travel back propagating in the same direction as the incident waves. The energy of the re-reflected wave will sum-up with the one characterising the incident wave field, biasing the results.

For the case of wave generation with active wave absorption for monochromatic waves, a standing wave is expected to be generated in the computational domain. Different instants of the CasePistonWallAWAS_REG simulation are shown in Figure 12-30 where the _PartFluid_xxxx.vtk_ of the fluid particles and the _PartPiston_xxxx.vtk_ of the piston using AWAS are depicted. In this case only incident and reflected waves are being propagated in the tank since re-reflection is prevented using AWAS. It can be observed how the velocity field is repeated every 2 seconds (wave period) which proves the correct behaviour of the AWAS implementation. 

If force against the vertical wall is computed, the effect of AWAS can be also analysed. If the re-reflected waves are prevented, then only incident waves should impact on the right vertical wall, which were generated as regular waves, so that regular pattern in the time series of force should be observed. Using _ComputeForces_, the force exerted onto the vertical wall was computed with and without AWAS. The Figure 12-31 demonstrates that time series of the wave force when the piston includes AWAS follows regular cycles.

<p align="center">
<img src="https://i.imgur.com/YLh0ODm.png" />
</p>

<p align="center">
<strong>Figure 12-30.</strong> Different instants of the CasePistonWallAWAS_REG simulation. Colour represents the horizontal velocity of the fluid.
</p>

<p align="center">
<img src="https://i.imgur.com/M0xjOaU.png" />
</p>

<p align="center">
<strong>Figure 12-31.</strong> Comparison between force exerted onto the right vertical wall with AWAS (CasePistonWallAWAS_REG) and without (CasePistonWallNoAWAS_REG) AWAS. 
</p>

The second example using AWAS includes a trapezoidal dike at the end of the tank. 
Different instants of the CasePistonDikeAWAS_REG simulation are shown in Figure 12-32 where the PartFluid_xxxx.vtk of the fluid particles and the PartPiston_xxxx.vtk of the piston using AWAS are depicted.

<p align="center">
<img src="https://i.imgur.com/AHgD0qU.png" />
</p>

<p align="center">
<strong>Figure 12-32.</strong> Different instants of the CasePistonDikeAWAS_REG simulation. Colour represents the horizontal velocity of the fluid.
</p>

In this example the force exerted onto the dike is computed using **ComputeForces**, but the overtopping can be also computed using **FlowTool**. The first row of the Figure 12-33 shows the area where the flows will be calculated; the grey box is _ResultFlow_boxes.vtk_ defined in the text file _CasePistonDike_FileBoxes.txt_. The others frames of the Figure 12-33 show the same instant of the simulation with and without AWAS and it can be seen how more particles reach the domain where overtopping will be measure since.

<p align="center">
<img src="https://i.imgur.com/wxIkAL0.png" />
</p>

<p align="center">
<strong>Figure 12-33.</strong> Same instant of the CasePistonDikeAWAS_REG and CasePistonDikeNoAWAS_REG simulations. Colour represents the horizontal.
</p>

Figure 12-34 plots the time series of the accumulative overtopping over the dike with and without AWAS. The overtopping is higher in the case without AWAS since more chaotic wave interactions took place in the tank and higher surface elevation reach the top of the dike, eventually.

<p align="center">
<img src="https://i.imgur.com/2L68wJa.png" width="550px"/>
</p>

<p align="center">
<strong>Figure 12-34.</strong> Comparison between accumulative overtopping with AWAS (CasePistonDikeAWAS_REG) and without (CasePistonDikeNoAWAS_REG) AWAS.
</p>

**12.1.11 FLOATING**

In this testcase, a 3-D floating box moves due to waves generated with a piston. A sinusoidal movement (`<mvrectsinu>`) is imposed to the boundary particles of the wavemaker and Periodicity in Y direction is also used. _wCaseFloating.bat_ (_xCaseFloating.sh_ in linux) file summarises the tasks to be carried out using the different codes.
Figure 12-35 shows different instants of the simulation of this test case. The floating object is represented using _MotionFloating_xxxx.vtk_ generated using **BoundaryVTK**, the piston with _MotionPiston_xxxx.vtk_ and the fluid with _PartFluid_xxxx.vtk_ (**PartVTK**).

<p align="center">
<img src="https://i.imgur.com/qvdJeiR.png" />
</p>

<p align="center">
<strong>Figure 12-35.</strong> Different instants of the CaseFloating simulation. 
Colour represents velocity of the particles.
</p>

The floating box is created using `<setdrawmode mode="full" />` so particles are located in the faces of the box and inside. Only floating objects created with `<setdrawmode mode="full" />` or `<setdrawmode mode="solid" />` have been validated using **DualSPHysics**. 

The 3-D motions and 3-D rotations of the floating box (mk:61) can be computed using **FloatingInfo** code. Hence, Figure 12-36 shows the time series of the surge, sway and heave motions while Figure 12-37 shows the pitch, roll and yaw angles.

<p align="center">
<img src="https://i.imgur.com/XcOMhvm.png" width="450px"/>
</p>

<p align="center">
<strong>Figure 12-36.</strong> Surge, sway and heave motions of the floating box.
</p>

<p align="center">
<img src="https://i.imgur.com/CivJMoN.png" width="450px"/>
</p>

<p align="center">
<strong>Figure 12-37.</strong> Pitch, roll and yaw rotation of the floating box.
</p>

In addition, a 2-D case of a falling sphere is also provided to simulate the buoyancy-driven motion of an unrestricted rigid body. The sphere has a relative density compared with water of 1.2 (density=1200 kg/m<sup>3</sup>). 

Different instants of the CaseFloatingSphereVal2D simulation can be observed in Figure 12-38 where _PartFluid_xxxx.vtk_, _PartFloating_xxxx.vtk_ (obtained using **PartVTK**) and _Slices_0000.vtk_ (obtained using **IsoSurface**) are depicted.

<p align="center">
<img src="https://i.imgur.com/CJ2v7TH.png" />
</p>

<p align="center">
<strong>Figure 12-38.</strong> Different instants of the CaseFloatingSphereVal2D simulation. Colour represents velocity of the fluid particles.
</p>

The file _EXP_FloatingSphereVal2D.ods_ contains the experimental displacement and velocity of experiments in [Fekken, 2004] and [Moyo and Greenhow, 2000] that can be numerically computed using the **FloatingInfo** code. Validation results can be also seen in [Canelas et al., 2015] where spheres are also created using `<setdrawmode mode="full" />`.

**12.1.12 FLOATINGWAVES**

This folder includes two cases of floating boxes under the action of waves that can be validated with experimental data (included in the folder):
* CaseFloatingWavesVal aims to reproduce the experiment of [Hadzic et al., 2005].
* CaseFloatingWavesVal2 aims to reproduce the experiment of [Ren et al., 2015].

**CaseFloatingWavesVal**

A 2-D case is designed where a floating box (density=680 kg/m<sup>3</sup>) moves under the action of non-linear waves in a tank with flap that reads rotational motion from an external file _CaseFloatingWavesVal_Flap.dat_ (time & angle) using `<mvrotfile>`.

_wCaseFloatingWavesVal.bat_ (_xCaseFloatingWavesVal.sh_ in linux) file summarises the tasks to be carried out using the different codes.

Different instants of the _CaseFloatingWavesVal_ simulation are shown in Figure 12-39 where the _PartFluid_xxxx.vtk_ of the fluid particles, the _PartMotion_xxxx.vtk_ of the piston and the _PartFloating_xxxx.vtk_ of the floating box are depicted.

<p align="center">
<img src="https://i.imgur.com/FDgANo3.png" />
</p>

<p align="center">
<strong>Figure 12-39.</strong> Different instants of the CaseFloatingWavesVal simulation. Colour represents the horizontal velocity of the fluid.
</p>

The force exerted onto the floating box has been also computed using **ComputeForces** (mk=61). Figure 12-40 shows the time series of the horizontal numerical force.

<p align="center">
<img src="https://i.imgur.com/1kJ5m4b.png" width="450px"/>
</p>

<p align="center">
<strong>Figure 12-40.</strong> Force (X-component) exerted on the floating box in CaseFloatingWavesVal. 
</p>

The 2-D motion of the floating box (surge, heave) and 2-D rotation (roll) can be computed using **FloatingInfo** code as shown in Figure 12-41.

<p align="center">
<img src="https://i.imgur.com/YrefZre.png" />
</p>

<p align="center">
<strong>Figure 12-41.</strong> Surge, heave and roll of the floating box in CaseFloatingWavesVal.
</p>

Experimental data from [Hadzic et al., 2005] is included in the file _EXP_FloatingWavesVal_Hadzic_et_al_2005.ods_. This validation can be also seen at [http://dual.sphysics.org/index.php/validation/wavesfloatings/](http://dual.sphysics.org/index.php/validation/wavesfloatings/).

**CaseFloatingWavesVal 2**

The case consists of a 2-D floating box that moves under the action of waves. The box is 0.3m wide and 0.2 m tall with a density of 500 kg/m<sup>3</sup>. The piston moves to create regular waves with wave height of 0.1 m, period of 1.2 s with a water depth of 0.4m.

_wCaseFloatingWavesVal2.bat_ (_xCaseFloatingWavesVal2.sh_ in linux) file summarises the tasks to be carried out in this example.

Different instants of the _CaseFloatingWavesVal2_ simulation are shown in Figure 12-42 where the _PartFluid_xxxx.vtk_ of the fluid particles, the _PartMotion_xxxx.vtk_ of the piston and the _PartFloating_xxxx.vtk_ of the floating box are depicted.

<p align="center">
<img src="https://i.imgur.com/AGr6EjN.png" />
</p>

<p align="center">
<strong>Figure 12-42.</strong> Different instants of the CaseFloatingWavesVal2 simulation. Colour represents the horizontal velocity of the fluid.
</p>

**IsoSurface** is also executed here to obtain the slices (instead of the isosurface). Therefore, an instant using the file _Slices_xxx.vtk_ can be seen in Figure 12-43.

<p align="center">
<img src="https://i.imgur.com/bbRu6rH.png" />
</p>

<p align="center">
<strong>Figure 12-43.</strong> Instant of the CaseFloatingWavesVal2 simulation plotting Slices_0110.vtk. Colour represents the horizontal velocity of the fluid.
</p>

The 2-D motion of the floating box (surge, heave) and 2-D rotation (roll angle) can be computed using **FloatingInfo** code as shown in Figure 12-44.

<p align="center">
<img src="https://i.imgur.com/P4svWCq.png" />
</p>

<p align="center">
<strong>Figure 12-44.</strong> Surge, heave and roll of the floating box in CaseFloatingWavesVal2.
</p>

Experimental data from [Ren et al., 2015] is included in the file _EXP_FloatingWavesVal2_Ren_et_al_2015.ods_. This validation can be also seen at [https://youtu.be/VDa4zcMDjJA](https://youtu.be/VDa4zcMDjJA). 

**12.1.13 PUMP**

This 3-D testcase loads an external geometry of a pump created with CAD (Figure 9-4). Two files are used; a fixed object (_pump_fixed.vtk_) and a moving part (_pump_moving.vtk_) that describes a rotational movement (`<mvrotace>`) and the reservoir is pre-filled with fluid particles (`<fillbox>`). _wCasePump.bat_ (_xCasePump.sh_ in linux) file summarises the tasks to be carried out using the different codes.

In Figure 12-45, the fixed _Pumpfixed.vtk_, the different _MotionPump.vtk_ and the _PartFluid_xxxx.vtk_ files of the fluid particles are represented at different instants of the simulation. 

<p align="center">
<img src="https://i.imgur.com/TLyy858.png" />
</p>

<p align="center">
<strong>Figure 12-45.</strong> Different instants of the CasePump simulation. Colour represents the density of the fluid particles.
</p>

**12.1.14 DEM**

This folder includes cases to be executed using DEM for the interaction between solids (RigidAlgorithm=2 in the XML). 

The first simulation demonstrates a ball hitting several blocks without any fluid particles being created. The file _Floating_Materials.xml_ contains properties of different materials; the ball and the bottom are defined as “steel” and the blocks are “pvc”. These means that those objects will use the parameters of that material; Young modulus, Poisson’s ratio, restitution coefficient and friction coefficient. 
_wCaseBowling.bat_ (_xCaseBowling.sh_ in linux) file summarises the tasks to be carried out using the different codes.

Different instants of the simulation plotting the files _PartSolids_xxxx.vtk_ can be seen in Figure 12-46. 

<p align="center">
<img src="https://imgur.com/q77Ktzu.png" />
</p>

<p align="center">
<strong>Figure 12-46.</strong> Different instants of the CaseBowling simulation.
</p>

The second DEM simulation consists of a 3-D dam-break flow impacting several blocks. Interaction between fluid and solids are computed using SPH and interaction between blocks and the blocks and the tank walls are computed using DEM. The file _Floating_Materials.xml_ contains properties of different materials; the walls and bottom of the tank are defined as “steel” and the blocks are “pvc”. 

_wCaseSolids.bat_ (_xCaseSolids.sh_ in linux) file summarises the tasks to be carried out using the different codes.

Figure 12-47 shows different instants of the simulation using the files _MotionBlocks_xxxx.vtk_ and _PartFluid_xxxx.vtk_. 

<p align="center">
<img src="https://i.imgur.com/ctLE2jR.png" />
</p>

<p align="center">
<strong>Figure 12-47.</strong> Different instants of the CaseSolids simulation. Colour represents the velocity of the fluid.
</p>

The third example using DEM includes an example of how to simulate a large number of floating objects. 2000 floating objects and no fluid are created in this case. The file _Floating_Materials.xml_ contains properties of different materials; the first 1000 floating objects will have properties of “hard-wood” and the other 1000 are “pvc”, all with a density of 300 kg/m<sup>3</sup>.

_wCaseManyFloatings.bat_ (_xCaseManyFloatings.sh_ in linux) file summarises the tasks to be carried out using the different codes. This scripts use a different version of **GenCase** (GenCase4_MkWord) that allows to create more floating or moving objects. 

The code **BoundaryVTK** is used to create **_MotionSpheres_xxxx.vtk_** that are depicted in Figure 12-48. Colour represents the ID of the objects.

<p align="center">
<img src="https://i.imgur.com/JY3mT1z.png" width="700px"/>
</p>

<p align="center">
<strong>Figure 12-48.</strong> Different instants of the CaseManyFloatings simulation. Colour represents the Id of the objects.
</p>

**12.1.15 POISEUILLE**

This test consists of a laminar flow between two parallel plates produced by a pressure gradient. 
* Distance between plates is 0.001 m.
* The density of fluid is 1000 kg/m<sup>3</sup>. 
* Fluid particles are induced by an acceleration of 1x10<sup>-4</sup> m/s<sup>2</sup>.
* Laminar viscosity is used here; ν = 1x10<sup>-6</sup> m<sup>2</sup>/s. 

The analytical solution of this problem is:
<p align="center">
<img src="https://i.imgur.com/JWXQkJA.png" />
</p>

Note that this case can only provide accurate results if resolution is high since the gap (on the order of 1.5h) between the fluid and DBC solid particles needs to be reduced as much as possible. Therefore, an initial particle distance of 2x10<sup>-5</sup> m was used, which means that initially there are 50 particles between plates.

<p align="center">
<img src="https://i.imgur.com/U80m3ar.png" />
</p>

<p align="center">
<strong>Figure 12-49.</strong> Different instants of the CasePoiseuille simulation.
</p>

The velocity profiles of the three instants depicted in Figure 12-49 can be numerically computed using **MeasureTool** and compared with the analytical solution. The file _CasePoiseuille_PointsVelocity.txt_ contains the position to compute the horizontal velocity and _Poiseuille_SPHvsAnalytical.ods_ contains the comparison with the analytical solution. Figure 12-50 plots these results. 

<p align="center">
<img src="https://i.imgur.com/3sbAQcH.png" />
</p>

<p align="center">
<strong>Figure 12-50.</strong> Comparison between analytical and numerical velocity profiles for different instants of the CasePoiseuille simulation.
</p>

## 12.2 EXTRA EXAMPLES

**ExternalDtFile**
The XML file named “_Dam2dDtFile.xml_” shows how to use predefined values of the time step “Δt” instead of the automatic computation of the variable time step (according to Eq. 30) by including the line:
`<parameter key="DtFixed" value="Dam2dDtFileData.txt" />`
The file _Dam2dDtFileData.txt_ includes the predefined values of the time steps (in ms). 

**ExternalViscoFile**
The XML file named “_Dam2dViscoFile.xml_” shows how to use predefined values of visco parameter (α in Eq. 8 of the artificial viscosity or υo in Eq. 9 of the laminar viscosity) that changes in time by including the line:
`<parameter key="ViscoTime" value="Dam2dViscoFileData.txt" />`
The file _Dam2dViscoFileData.txt_ includes the predefined values of _visco_.

**GaugeSystem**
This folder contains several examples of how to compute different magnitudes during the execution of DualSPHysics. This functionality can be very useful to obtain information _on the fly_. 
The XML section `<gauge>` includes different options: 
* default: defines configuration of all gauges (create VTK, output frequency, etc)
* swl: computes free surface along a line according to the direction defined by the order of the two points that defined that line (this option is used in AWAS)
* velocity: computes velocity at a given position 
* maxz: computes maximum Z-position of fluid along a vertical line
_GSwl_Dam2d.xml_: example to compute free surface
_GVel_Dam2d.xml_: example to compute velocity
_WallRegAwas2.xml_: example to save free surface that AWAS is internally using
Note that CaseDambreaVal2D in **examples\main\01_DamBreak** also includes an example of the use of `<gauge>`. 

**PosDouble**
The XML file named “_PDam2d.xml_” shows how to use double precision by including the line:
`<parameter key="PosDouble" value="2" />`
This option means that particle interaction is performed using double precision for variables of position and final position is stored using double precision. The use of double is important to solve problems and instabilities when the domain is huge in comparison to the distance of interaction between particles.

**RedrawGenCase**
This folder includes examples of how to create particles and modify properties (mk, type, …) of others previously created or how to create particles in the border of an object, which can be useful for example to avoid holes in the boundaries.
As mentioned in Section 9, **Gencase** employs a 3-D Cartesian lattice to locate particles. These particles are created at the nodes of that lattice.  A value of “mk” is assigned to each node according to the type of particle (boundary, fluid or void) and to define a special behaviour during the simulation.

The `<redraw>` command assigns the “mk” defined by the last `<setmkvoid>`, `<setmkbound>` or `<setmkfluid>` to all nodes that follow a given condition. 

**Example A:**

`<setmkbound mk="3" /> defines the “mk” for the nodes starting from here `
`<redraw mkfluid="1" /> changes all previous cells with mkfluid=1`

The `<redrawnear>` command allows to indicate the nodes that will be modified if there is a neighbouring node that follows some given condition.

Example B:

`<redrawnear targettp="fluid" bordertp="bound" /> modifies all nodes of fluid (targettp="fluid") that have a neighbouring node of type boundary (bordertp="bound")`

Example C:

`<redrawnear targettp="void" bordertp="bound" bordermk="2" /> modifies all nodes of type void (targettp="void") that have a neighbouring node of type boundary (bordertp="bound") and with mk=2 (bordermk="2")`

These three examples are shown in Figure 12-51. Note that squares are used here to represent the individual nodes (particles will be created in those nodes) for clarity.

<p align="center">
<img src="https://i.imgur.com/qp3z8Rq.png" />
</p>

<p align="center">
<strong>Figure 12-51.</strong> Example A, B and C of the use of <redraw> and <redrawnear> commands.
</p>

The `<redrawnear>` command can also indicate how many times the task should be done using times=”2”. In addition, the domain of nodes that will be modified can be defined using variants `<redrawbox>` o `<redrawnearbox>`.

One of the examples included in this folder is _RedrawSimple.xml_ where `<redraw>` is employed to close the holes in the boundary before filling with fluid (see Figure 12-52). The cases _RedrawComplex.xml_ y _RedrawComplexPeriodic.xml_ are more complex cases where the all options of `<redraw>` and `<redrawnear>` are used. 

<p align="center">
<img src="https://i.imgur.com/6xquz9W.png" width="450px"/>
</p>

<p align="center">
<strong>Figure 12-52.</strong> Different steps of the tasks in the example RedrawSimple.xml.
</p>

**ReStart**

Once a simulation with DualSPHysics was executed and finished or incomplete, the simulation can be executed again starting from the last time step. It is worth noting that two folders are necessary; one to include the output data of the first run and a second folder to include the output data of the continuation of the simulation. Thus, the last time step of the first run is used as the first time step of the second run using the `–partbegin` option.

The script file named _wCaseOpenFtMove_win64_GPU.bat_ includes an example to restart a simulation and to use the post-processing tools with output data generated in two different folders (_xCaseOpenFtMove_win64_GPU.sh_ in linux). 

The example included in the folder follows these steps:

_CaseOpenFtMove_Def.xml_; TimeMax=4s & TimeOut=0.01s so 400 files will be created.

1. Creates the output folder _CaseOpenFtMove_out_
2. Executes **GenCase **
3. Executes DualSPHysics to simulate the time interval _0-1 seconds (100 output files)_
`DualSPHysics.exe -gpu CaseOpenFtMove_out/CaseOpenFtMove CaseOpenFtMove_out -tmax:1`
4. Executes **PartVTK**, **BoundaryVTK**, **IsoSurface**, **FloatingInfo** and **MeasureTool**

In _CaseOpenFtMove_out_ we can find the first 100 files (from 0 to 100) that will be the .bi4 files and the ones generated by the post-processing tools.

5. Creates the output folder _CaseOpenFtMove_restart_out_
6. Executes **GenCase** 
7. Executes **DualSPHysics** to simulate the time interval _1-4 seconds (300 more files)_
`DualSPHysics.exe -gpu CaseOpenFtMove_restart_out/CaseOpenFtMove CaseOpenFtMove_restart_out -partbegin:100 CaseOpenFtMove_out`
8. Executes **PartVTK**, **BoundaryVTK**, **IsoSurface**, **FloatingInfo** and **MeasureTool**
Note that now for the second run, BoundaryVTK also uses `-motiondata0`.

In _CaseOpenFtMove_restart_out_ we can find the next 300 files (from 100 to 400) that will be the .bi4 files and the ones generated by the post-processing tools.

**RotatedBox**

This folder includes an example of using `<rotateaxis>`. 
In _RotatedBox.xml_, two different boxes will be created; 

i) one box is created based on the 3-D Cartesian lattice used by GenCase, so that, the particles will be created in the nodes of that lattice (red box in Figure 12-53)

ii) the second box, is initially created using `<drawbox>` and later uses `<rotateaxis>` (in `<initials>` section) to apply a matrix that rotates the position of the particles of the box, so that, particles are finally created in global positions that are not linked to the nodes of the 3-D lattice (green box in Figure 12-53).

Hence, the “stair” effect observed in the red box is no longer observed in the green one.

<p align="center">
<img src="https://i.imgur.com/3EN2fs3.png" />
</p>

<p align="center">
<strong>Figure 12-53.</strong> Geometry generated using RotatedBox.xml.
</p>

**SaveDt** 
The XML file named “_Case5aSvdt_8k.xml_” shows how to save information about the time steps “Δt”. The value of the time step at each step is variable and computed according to Eq. 30. With this option, the user can save for a given interval of the simulation the different values that are used to determine the new time step; maximum accelerations, viscous terms, maximum velocity, ∆tf (based on the force) and ∆tcv (combines the Courant and the viscous terms). 

**TimeOut**
The XML file named “Dam2d.xml” shows how to modify the frequency to store output data for a given interval using <timeout>. This can be useful to store more output files (more frequently) to get more information during some interesting time intervals and less frequent the rest of the simulation. 


## 12.3 MULTIPHASE EXAMPLES

In the folder **examples\twophases\DSPH_v3.4_LiquidSediment**, there is an example of a case with two phases; water and sediment. A PDF document is attached with detailed description of the case: “Guide_CaseDambreak_Sediment.pdf” 

_wCaseDambreak_Sediment.bat_ (_xCaseDambreak_Sediment.sh_ in linux) file summarises the tasks to be carried out using the different codes.

Different instants of the simulation plotting _CaseDambreak_Sediment_Bound.vtk_, the files _PartFluid_xxxx.vtk_ and _PartSediment_xxxx.vtk_ can be seen in Figure 12-54. 

<p align="center">
<img src="https://imgur.com/5TWaQ0i.png" />
</p>

<p align="center">
<strong>Figure 12-54.</strong> Different instants of the CaseDambreak_Sediment simulation.
</p>

<br>

The following test cases are included in **examples\twophases\DSPH_v4.0_LiquidGas**:

<p align="center">
<img src="https://imgur.com/HHcS9VM.png" />
</p>

<p align="center">
<strong>Figure 12-55.</strong> Testcases of the multiphase code Liquid-Gas.
</p>

## 12.4 CHRONO EXAMPLES

## 12.5 WAVECOUPLING EXAMPLES
The DualSPHysics package includes examples of coupling with wave propagation models employing the multi-layered piston wavemaker and the relaxation zone techniques. The latter one is also used as stand-alone wave and current generation in DualSPHysics. These examples can be found in the subfolder **examples/wavecoupling**. 
The cases provided are listed as follows:

ML_CIEM
* 2-D case of regular wave run-up on a beach, validated against physical model tests carried out at the Canal d’Investigació i Experimentació Marítima (CIEM) of the Universitat Politècnica de Catalunya (UPC), in Barcelona. [(Scandura & Foti, 2011)](https://doi.org/10.1080/00221686.2011.591046). SWASH model is coupled with DualSPHysics by means of multi-layered piston wavemaker (one-way offline coupling). 
RZ_RegularWaves
* 2-D regular wave case where the waves are generated by means of relaxation zone.
RZ_IrregularWaves
* 2-D irregular wave case where the waves are generated by means of relaxation zone.
RZ_Flow2D
* 2-D case where relaxation zone technique is employed to generate currents by applying a uniform velocity profile, variable in time. 
RZ_FlowCylinder3D
* 3-D case of flow around a vertical cylinder where relaxation zone technique is employed to generate currents by applying a uniform velocity profile, variable in time.
RZ_Coupling
* 2-D regular wave case where the wave orbital velocities are provided by SWASH model and imposed to the SPH fluid particles within the relaxation zone. 

**12.5.1 ML_CIEM**

The first case of wavcoupling is employing the geometry and the wave conditions from an experimental campaign carried out  at the Canal d’Investigació i Experimentació Marítima (CIEM) of the Universitat Politècnica de Catalunya (UPC), in Barcelona. The CIEM flume is a large-scale wave flume of 100m length, 3m width and 4.5m depth.  Several experiments were carried out within the framework of the Scandura data set [(Scandura & Foti, 2011)](https://doi.org/10.1080/00221686.2011.591046), part of the Hydralab III EU-funded project.
Regular waves are used for the present case study. SWASH model has been previously validated against the experimental data. Then, location for the coupling between SWASH and DualSPHysics model has been set at x=43.10m from the initial position of the experimental wavemaker at rest.

Regular waves are used for the present case study. SWASH model has been previously validated against the experimental data. Then, location for the coupling between SWASH and DualSPHysics model has been set at x=43.10m from the initial position of the experimental wavemaker at rest.

The bacth file _w01_CaseML_CIEM_SWASH_win64.bat_ executes **SWASH (v.5.01)**, extract the velocity data at the coupling location and create .vtk files to visualize the velocity and the displacement of the Moving-Layer Piston in Paraview. The SWASH input files are located in the subfolder **01_ML_CIEM/CIEM_SWASH**. They include a file containing the vertical coordinate of the flume bottom (_CIEM_SWASH.bot_), a file with the position of the wave gauges where to measure free-surface elevation and velocity in SWASH (_CIEM_SWASH.loc_), a file containing the input time series to generate waves in SWASH, reconstructed using reflection method from the physical model experiments (_CIEM_SWASH.bnd_) and the main SWASH input file (_CIEM_SWASH.sws_). 
The batch file _w02_CaseML_CIEM_win64_GPU.bat_  executes DualSPHysics and the post-processing tools.

<p align="center">
<img src="https://imgur.com/Pbbd0KE.png" />
</p>

<p align="center">
<strong>Figure 12-X1.</strong> Snapshot of CaseML_CIEM simulation. Colour represents the horizontal velocity of the fluid.
</p>

An instant the CaseML_CIEM simulation is shown in Figure **12-x1** where the PartFluid_0345.vtk of the fluid particles and the PartMov_0345.vtk (in red) of the multi-layered piston wavemaker are depicted. The boundary, including the beach, is depicted in white color. 
Water surface elevation is measured using **MeasureTool**. Detailed comparisons of water surface elevation and velocities with experimental results can be found in [Altomare et al. (2015b)](https://doi.org/10.1142/S0578563415500242). This validation can be also seen at https://www.youtube.com/watch?v=OzPjy2aMuKo 

**12.5.2 RZ_RegularWaves**

In the 02_RZ_RegularWaves  case, regular waves are generated by means of the relaxation zone technique (RZ). There is no coupling with other models. DualSPHysics is used as stand-alone model where, instead of employing moving boundaries, waves are generated by imposing theoretical orbital velocities to the fluid SPH particles within the relaxation zone. 
Wave generation with RZ is defined in the _“CaseRZ_RegularWaves_Def.xml”_  as **special**  within **execution**, where key lines of the RZ method are the lines: 
* **center x="-1.775853" y="1" z="0" comment="Central point of application"** : defines the center of the area covered by the relaxation zone.
* **width value="3.551707" comment="Width for generation"**: defines the total width of the relaxation zone.
* **function psi="0.35" beta="5" comment="Coefficients in function for velocity (def. psi=0.9, beta=1)"** : they are the values of the parameters _ψ_ and _β_ of the weighting function C.
* **driftcorrection value="1.0" comment="Coefficient of drift correction applied in velocity X. 0:Disabled, 1:Full correction (def=0)"**: to correct the mass transport predicted by Stokes´s theory, a drift correction must be applied. The correction is automatically calculated by DualSPHysics. The  **driftcorrection value** defines the weight to apply to this correction (1=100%).

Regular waves are used for the present case study. A rectangular tank (i.e. horizontal bottom) with passive absorption at both sides of the domain is modelled. Passive absorption is specified by **dampingzone** in the _“CaseRZ_RegularWaves_Def.xml”_  to prevent wave reflection from the domain sidewalls. The batch file _wCaseRZ_RegularWaves_win64_GPU.bat_  executes DualSPHysics and the post-processing tools.

<p align="center">
<img src="https://imgur.com/JaUtZL0.png" />
</p>

<p align="center">
<strong>Figure 12-X2.</strong> Snapshot of CaseRZ_RegularWaves  simulation. Colour represents the horizontal velocity of the fluid.
</p>

An instant the 02_RZ_RegularWaves  simulation is shown in Figure **12-X2** where the PartFluid_0229.vtk of the fluid particles are depicted. The solid red line indicates edges of the relaxation zone inside which the theoretical velocity is imposed. Only horizontal velocities are applied, see line **coefdir x="1" y="0" z="0" comment="Coefficients for each direction (default=(1,0,0))"**.
Using the **MeasureTool** code, numerical water surface elevation and wave orbital velocities have been computed in the list of points described in the file _heights.txt_ and _velocity.txt_. The output results can be compared with the theoretical solution calculated by defining in the _“CaseRZ_RegularWaves_Def.xml” _  the following line: 
**savemotion periods="80" periodsteps="32" xpos="5.3276" zpos="-0.4" comment="Saves motion data. xpos and zpos are optional. zpos=-depth of the measuring point"**

**12.5.3 RZ_IrregularWaves**

In the 03_RZ_IrregularWaves  case, irregular waves are generated by means of the relaxation zone technique (RZ). There is no coupling with other models. DualSPHysics is used as stand-alone model where, instead of employing moving boundaries, waves are generated by imposing theoretical orbital velocities to the fluid SPH particles within the relaxation zone. 
Wave generation with RZ is defined in the _“CaseRZ_IrregularWaves_Def.xml”_  as **special ** within **execution**. The main difference with the 02_RZ_RegularWaves  case is the definition of irregular waves using a pre-defined standard spectrum in **relaxationzones** (see line **rzwaves_spectrum ** and following ones). 

A rectangular tank (i.e. horizontal bottom) with passive absorption at both sides of the domain is modelled. Passive absorption is specified by **dampingzone** in the _“CaseRZ_IrregularWaves_Def.xml”_ to prevent wave reflection from the domain sidewalls. The batch file _wCaseRZ_IrregularWaves_win64_GPU.bat_  executes DualSPHysics and the post-processing tools.

<p align="center">
<img src="https://imgur.com/gSTlV4O.png" />
</p>

<p align="center">
<strong>Figure 12-X3.</strong> Snapshot of CaseRZ_IrregularWaves simulation. Colour represents the horizontal velocity of the fluid.
</p>

An instant the 03_RZ_IrregularWaves simulation is shown in Figure **12-x3** where the PartFluid_0155.vtk of the fluid particles are depicted. The solid red line indicates edges of the relaxation zone inside which the theoretical velocity is imposed. Only horizontal velocities are applied, see line **coefdir x="1" y="0" z="0" comment="Coefficients for each direction (default=(1,0,0))"**. Looking figures **12-x2** and **12-x3**, the user can notice the differences in the water surface profile, regular monochromatic in **12-x2** , meanwhile in figure **12-x3** is characterized by individual waves of different amplitude and period.
Using the **MeasureTool** code, numerical water surface elevation and wave orbital velocities have been computed in the list of points described in the file _heights.txt_ and _velocity.txt_. The output results can be compared with the theoretical solution calculated by defining in the _“CaseRZ_IrregularWaves_Def.xml”_   the following line: 
**savemotion periods="80" periodsteps="32" xpos="5.3276" zpos="-0.4" comment="Saves motion data. xpos and zpos are optional. zpos=-depth of the measuring point"**

**12.5.4 RZ_Flow2D**

The 04_RZ_Flow2D  case employs relaxation zone to generate currents in a confined model domain. The currents are generated by applying uniform velocity profile within RZ, which can be constant or can vary in time. Everything is defined in the _“CaseRZ_Flow2D_Def.xml”_, at the line **rzwaves_uniform** where the direction, magnitude and duration of the velocity can be specified. 
The generation is defined at lines:
**domainbox**
      **point x="0.6" y="-0.05" z="0"**
      **size x="0.3" y="0.1" z="0.2" **
      **direction x="-1" y="0" z="0"**
**domainbox**

Meanwhile the velocity magnitude and duration is specified by lines such as <timevalue time="1.0" v="0.3" />. In this example a velocity of 0.3m/s will be applied starting from t=1s.

<p align="center">
<img src="https://imgur.com/9dRab5B.png" />
</p>

<p align="center">
<strong>Figure 12-X4.</strong> Snapshot of CaseRZ_Flow2D simulation. Colour represents the horizontal velocity of the fluid.
</p>


Other example of current generation in combination with waves can be seen at https://www.youtube.com/watch?v=XkXcxvawiuA where the waves and current system of the large-scale flume CIEM of [LIM/UPC](https://ciemlab.upc.edu/en/facilities/ciem-1/ciem) is modelled. 

**12.5.5 RZ_FlowCylinder3D**

Similar to the previous case, the relaxation zone is applied in the 05_RZ_FlowCylinder3D case to generate currents. In this case, the domain is not confined. Periodicity in X direction is used. The velocity is imposed and controlled in the relaxation zone
The currents are generated by applying uniform velocity profile within RZ, which can be constant or can vary in time. Everything is defined in the _"CaseRZ_FlowCylinder3D_Def.xml”_ , at the line <rzwaves_uniform /> where the direction, magnitude and duration of the velocity can be specified. 
A snapshot of the 3-D simulation is depicted in Figure **12-x5** . Karman vortexes are visible on the free surface. The yellow line before the cylinder defines the area where the relaxation zone is defined.

<p align="center">
<img src="https://imgur.com/YSb2irP.png" />
</p>

<p align="center">
<strong>Figure 12-X5.</strong> Snapshot of CaseRZ_FlowCylinder3D simulation.
</p>

**12.5.6 RZ_Coupling**

In the 06_RZ_Coupling  case, DualSPHysics is coupled with SWASH model by means of the relaxation zone. Regular waves are generated, imposing the velocity to the SPH fluid particles in the relaxation zone, by interpolating and applying the velocity calculated in SWASH for each layer. 
The bacth file _w01_RZ_Coupling_SWASH_win64.bat_ executes **SWASH (v.5.01)**, extract the velocity data at several coupling locations covering the whole relaxation zone width create .csv files that will be used by DualSPHysics. The **ReadSwash2_win64** tool is used for the purpose. 
The SWASH input files are located in the subfolder **06_RZ_Coupling/Case_SWASH_8L**.  They include a file containing the vertical coordinate of the flume bottom (_Case_SWASH_8L.bot_), a file with the position of the wave gauges where to measure free-surface elevation and velocity in SWASH (_Case_SWASH_8L.wvg_) and the main SWASH input file (_Case_SWASH_8L.sws_). Regular waves are reproduced (see SWASH input file). 
Wave generation with RZ is defined in the _“CaseRZ_Coupling_Def.xml”_ as <special>  within <execution>, where key lines of the RZ method are the lines: 
* **filesvel value="Case_SWASH_8L_corr" comment="Main name of files with velocity to use"**: it defines the name of the .csv files that contain the velocity as calculated in SWASH. 
* **filesvelx initial="0" count="5" comment="First file and count to use**: The numebrs defines the index of the .csv file that will be read by DualSPHysics, in this example from Case_SWASH_8L_corr_velx_x00_y00.csv to Case_SWASH_8L_corr_velx_x04_y00.csv
* **movedata x="-0.177585" y="1" z="0.8" comment="Movement of data in CSV files"**: the coordinate where the the velocity calculated by SWASH will be applied in DualSPHysics are shifted along the 3 axis.

A rectangular tank (i.e. horizontal bottom) with passive absorption at both sides of the domain is modelled. Passive absorption is specified by **dampingzone** in the _“CaseRZ_Coupling_Def.xml”_ to prevent wave reflection from the domain sidewalls. The batch file _wCaseRZ_Coupling_win64_GPU.bat_  executes DualSPHysics and the post-processing tools.

<p align="center">
<img src="https://imgur.com/mKBtX6x.png" />
</p>

<p align="center">
<strong>Figure 12-X6.</strong> Snapshot of CaseRZ_Coupling  simulation. Colour represents the horizontal velocity of the fluid.
</p>

An instant the 06_RZ_Coupling  simulation is shown in Figure **12-x6** where the PartFluid_0635.vtk of the fluid particles are depicted. The solid red line indicates edges of the relaxation zone inside which the theoretical velocity is imposed. 
Using the **MeasureTool** code, numerical water surface has been computed in the list of points described in the file _heights.txt_. The output results can be compared with the ones calculated by SWASH. 


## 12.6 INLET/OUTLET EXAMPLES

A series of examples is included in the folder <strong>/examples/inletoutlet</strong> to show how to implement simulations using open boundary conditions. Through these solved examples it is also possible to test the ability of inlet and outlet conditions to reproduce fluid flow accurately. Several flows are simulated, including confined and free-surface flow, flow in absence of gravity, wave generation, etc. A short summary of each test case is listed below, followed by a more thorough explanation.

<p align="center">
<img src="https://i.imgur.com/z1IF7H8.png" />
</p>

<p align="center">
<strong>Figure 12-X7.</strong> List of inlet/outlet test cases provided with the version 4.4 of DualSPHysics.
</p>

- <a href="#obc1"><strong>1_FlowCylinder</strong></a>: 2-D flow past a circular cylinder in steady and unsteady modes: Reynolds = 20 (steady flow) and Reynolds = 200 (unsteady flow)
- <a href="#obc2"><strong>2_OpenChannel</strong></a>: 2-D open channel flow over a sloped channel at Reynolds = 100
- <a href="#obc3"><strong>3_ReverseFlow</strong></a>: 2-D flow reversion, where the reversion is shown by means of a floating body immersed in the flow
- <a href="#obc4"><strong>4_Waves2D</strong></a>: 2-D wave generation over a sloped beach, where the waves are generated at the inlet using predefined velocities from linear wave theory
- <a href="#obc5"><strong>5_ShapesInlet3D</strong></a>: 3-D simulation showing capability to generate buffers with different shapes, such as cylindrical or diamond shapes.
- <a href="#obc6"><strong>6_Box4Inlet3D</strong></a>: 3-D simulation showing capability to utilize several inlets and outlets in a simulation.
- <a href="#obc7"><strong>7_CurrentHull</strong></a>: 3-D simulation showing the free-surface flow past a ship hull in a narrow channel.

<a name="obc1"></a>
**12.6.1 1_FlowCylinder**
The first test case shows the effectiveness of the proposed algorithm in simulating 2-D flow past a circular cylinder at different Reynolds numbers. A cylinder of diameter <i>D</i> = 0.2 m is discretized by dynamic boundary particles and surrounded by water. The fluid is initialized with a constant x-velocity, <i>U</i> = 1 m/s and a null y-velocity. The Reynolds number is defined as Re = <i>U</i> <i>D</i>/<i>nu</i>, where <i>nu</i> the kinematic viscosity in m<sup>2</sup>/s. 

Two buffers are created left and right of the domain using the <strong>inoutzone</strong> and <strong>zone2d</strong> options, the former indicating the creation of a new buffer and the latter indicating the buffer dimension (2-D).
The buffers are created each with a width of four particle layers, to ensure full kernel for adjacent fluid particles. This is done using the option <strong>layers value="4"</strong>. The left buffer represents the inlet zone, where the x-velocity set to the constant value of <i>U</i> using the option <strong>imposevelocity mode="0"</strong> and imposing the numerical value <strong>velocity v="1.0"</strong>. For the right buffer (outlet) the velocity of the buffer particles is obtained using the ghost nodes via the option <strong>imposevelocity mode="2"</strong>. The same extrapolation process is utilized to compute the density, and hence pressure, of all buffer particles by adopting <strong>imposerhop mode="2"</strong>. This extrapolation process is also adopted for the remaining two boundaries (top and bottom) made of dynamic boundary particles (DBP). While the velocity of these DBP is assigned equal to that of the inlet, the density is retrieved via the ghost nodes using the option <strong>boundcorr</strong>, which allows the extrapolation of the density of DBP using the open boundary algorithm rather than the DBP equations. The use of boundcorr is quite simple and is as follows:
* First one defines the <i>mk</i> of the DBP particles to which the correction is applied, i.e. <strong>mkzone mkbound="1"</strong>
* Then, the threshold between the first layer of DBP and the first layer of fluid is defined using x,y,z coordinates in the option <strong>limitpoint x="0" y="0" z="-0.995"</strong>, this particular triad indicating a horizontal line at z=-0.995.
* Finally, the direction to the fluid is to be specified by use of the option <strong>direction x="0" y="0" z="1"</strong>, this particular triad indicating a positive z-direction for the creation of the ghost nodes.

The viscosity is varied to simulate different Reynolds numbers, particularly a steady case (Re = 20, Figure 12-X8 below) and an unsteady case (Re = 200, Figure 12-X9 below).

<p align="center">
<img src="https://i.imgur.com/cf9AM9b.png" />
</p>

<p align="center">
<strong>Figure 12-X8.</strong> Contours of velocity magnitude (top) and vorticity in Y (bottom) for Re = 20.
</p>

<p align="center">
<img src="https://i.imgur.com/X9T7kdf.png" />
</p>

<p align="center">
<strong>Figure 12-X9.</strong> Contours of velocity magnitude (top) and vorticity in Y (bottom) for Re = 200.
</p>

For the unsteady case, the accuracy of the obtained flow behavior can be quantified via the Strouhal number <i>St</i> = <i>f</i> <i>D</i>/<i>nu</i>, whose values are provided in [Tafuni et al. 2018](https://doi.org/10.1016/j.cma.2018.08.004) for several Reynolds numbers. For the case Re = 200 the reference value is <i>St</i> = 0.206. Using the **MeasureTool** code, the vorticity is calculated in the wake at a distance <i>D</i> away from the cylinder and vertical coordinate z=0, as specified in the file _points_cyl.txt_. The obtained signal has periodic peaks which allow to estimate the vortex shedding frequency. A Strouhal number of 0.223 is obtained for this test case. This result is within 10% of the correct value, which is acceptable for the level of resolution adopted.

<p align="center">
<img src="https://i.imgur.com/T2fCp1E.png" />
</p>

<p align="center">
<strong>Figure 12-X10.</strong> Time history of the vorticity in the wake at a distance X of one diameter from the cylinder and a vertical coordinate equal to z=0).
</p>

<a name="obc2"></a>
**12.6.2 2_OpenChannel**
Free-surface flow in a two-dimensional channel is presented in this test case. The channel has a depth H = 1 m, a length L = 8H, and is bounded by two buffer areas, similarly to the cylinder case. Inflow and outflow boundary conditions are imposed on the left and on the right of the domain, respectively. The flow is gravity-dominated and presents a free surface, which requires a third flow variable to be determined at the open boundaries, the water depth. For both buffers the water depth is extrapolated from the fluid domain using the ghost nodes via the option <strong>imposezsurf mode="2"</strong>. Here two additional options are shown, <strong>zbottom value="0"</strong> which defines the z of the channel bottom to calculate hydrostatic pressure, and <strong>zsurf value="1.04"</strong> which defines the total buffer height. Note that the buffer height can be larger than the initial water height to account for increases of free-surface depth during the simulation. The density of outflow particles is now assigned so that a hydrostatic pressure distribution is obtained and enforced at the outlet throughout the simulation. The fluid is water with a null velocity in the y-direction, and a velocity in the x-direction given by a parabolic velocity. This profile is enforced using <strong>imposevelocity mode="0"</strong> and then specifying the velocity at three depths, for example <strong>velocity3 v="0" v2="6" v3="8" z="0" z2="0.5" z3="1"</strong>. The channel is created horizontal; to emulate the effect of a 5-degree slope the gravity vector is changed accordingly as <strong>gravity x="0.855" y="0" z="-9.773"</strong>.

<p align="center">
<img src="https://i.imgur.com/YViJYSf.png" />
</p>

<p align="center">
<strong>Figure 12-X11.</strong> Contours of velocity magnitude (top) and pressure (bottom) for open-channel flow at Re = 100.
</p>

The solution can be validated against the analytical solution provided in [Tafuni et al. 2018](https://doi.org/10.1016/j.cma.2018.08.004). Using the **MeasureTool** code, the velocity profile along Z at the center of the domain is computed using list of points described in the file _points_oc.txt_. The output results can be compared with the theoretical solution calculated in the Excel file <strong>Analytical_solution_slope_channel.xslx</strong> provided in the test case folder. The comparison can be seen below in Figure 12-X11 and is quite good despite the coarse resolution adopted in this test case.

<p align="center">
<img src="https://i.imgur.com/kOLWXr4.png" />
</p>

<p align="center">
<strong>Figure 12-X12.</strong> Comparison between SPH and analytical velocity profiles (horizontal axis in figure) along the z-direction (vertical axis in figure) for open-channel flow at Re = 100.
</p>

<a name="obc3"></a>
**12.6.3 3_ReverseFlow**
A second case of 2-D open-channel flow is included in this test case with the purpose of simulating flow reversion in the buffer regions. The geometry and boundary conditions are similar to the previous open-channel case with the following modifications: the velocity is now predefined throughout the fluid and inflow area, while the free-surface elevation is extrapolated from the domain interior in both buffers. Moreover, the inlet velocity changes over time from the initial value of 1.0 m/s to a null value at 8.0 s, a negative value of -1.0 m/s at 9.0 s, a null value at 15.0 s, and a positive value of 1.0 m/s at 15.5 s. These values are imposed using the value <strong>imposevelocity mode="1"</strong> along with the option <strong>velocitytime</strong> -> <strong>timevalue time="0" v="1"</strong>, <strong>timevalue time="8" v="0"</strong>, ..., <strong>timevalue time="15.5" v="1"</strong>. All outlet quantities are calculated from the ghost nodes. To better visualize the presence of backflow, a rectangular floating object is created, initially outside of the fluid domain. The object has a specific gravity of 0.95 and is discretized by dynamic boundary particles.

<p align="center">
<img src="https://i.imgur.com/a2dARkH.png" />
</p>

<p align="center">
<strong>Figure 12-X13.</strong> Screenshot of velocity magnitude for the case of reverse flow with floating body.
</p>

<a name="obc4"></a>
**12.6.4 4_Waves2D**

The capability of the proposed open boundary algorithm of generating waves is shown in this test case. A numerical tank is simulated where regular waves are generated using the new open boundary formulation. The water depth is 0.27 m. Regular water waves of height H=0.1 m, with period T=1.3 s and wavelength 1.89 m, are propagated along a 8-m-long tank with a 1:5-sloped dissipative beach at the end, in order to absorb the reflected waves and analyze only the incident waves. The inlet velocities are imposed by means of the external file _waves.csv_ present in the test case folder. To read from this file, when imposing the velocity at the inlet buffer the value <strong>imposevelocity mode="1"</strong> along with the option <strong>velocityfile file="waves.csv"</strong> is used so that at each time step the velocity of the inlet particle is fed by an external source.

<p align="center">
<img src="https://i.imgur.com/je2kKkU.png" />
</p>

<p align="center">
<strong>Figure 12-X14.</strong> Wave generation using imposed velocity from linear wave theory at the inlet.
</p>

These regular waves belong to Stokes' second-order wave theory, hence numerical results can be compared with theoretical predictions. One of the advantages of using open boundaries to propagate waves into the SPH domain is the ease of coupling with other models, such as mesh-based codes or wave propagation models that can provide the velocity field or the depth time series to be imposed in the buffer zone to achieve correct inlet/outlet behavior for wave generation.

<a name="obc5"></a>
**12.6.5 5_ShapesInlet3D**
In this test case different buffer shapes for three dimensional simulations are created. All different regions are generated in the context of the <strong>zone3d</strong> environment. Particularly:

* A square inlet is created using the option <strong>box</strong>, starting from a seed point (<strong>point x="0.3" y="2.8" z="0.5"</strong>) and extruding using the option <strong>size x="0.5" y="0" z="0.4"</strong>. As seen previously, the direction for creation of the ghost nodes is also assigned via the tag <strong>direction x="0" y="-1" z="0"</strong>.

* A diamond-shaped inlet is obtained using the same set-up as the square inlet but adding the option <strong>rotateaxis angle="-45" anglesunits="degrees"</strong> to rotate the buffer of a 45 degree angle with respect to a fixed axis, whose coordinates are given by two points, namely <strong>point1 x="1.4" y="0" z="0.7"</strong> and <strong>point2 x="1.4" y="1" z="0.7"</strong>

* A circular inlet is generated using the option <strong>circle</strong> starting from the center of the circle (<strong>point x="2.2" y="2.8" z="0.7"</strong>) and indicating its radius (<strong>radius v="0.2"</strong>).
 
<p align="center">
<img src="https://i.imgur.com/VOL5jX1.png" />
</p>

<p align="center">
<strong>Figure 12-X15.</strong> Different types of buffer shapes created via the new inlet/outlet algorithm.
</p>

<a name="obc6"></a>
**12.6.6 6_Box4Inlet3D**

Water flow in a stationary cubic tank with multiple inlets is shown in this test case. Dynamic boundary particles are used to discretize the tank. Four inlets are introduced, one on the lower right corner of each side of the tank, from which water flows with an initial velocity of 2.0 m/s. The inflow buffers are set to ‘Inlet Only’ behavior, meaning that no backflow is allowed in any of the inlet areas. Such condition is enforced by setting the parameter <strong><convertfluid value="false"</strong>. This is important when a strict inflow condition is desired as fluid particles are allowed to cross the permeable boundary only in one direction. This feature can be disabled by the user depending on the application.

<p align="center">
<img src="https://i.imgur.com/Ar37Qmw.png" />
</p>

<p align="center">
<strong>Figure 12-X16.</strong> Multi-inlet multi-outlet demonstration via 3-D box filled with water using four inlet areas.
</p>

<a name="obc7"></a>
**12.6.7 7_CurrentHull**

The last test case presented for inlet/outlet conditions is the flow around the hull of a boat. The open boundary formulation is essential in simulations of this kind because it provides an optimal size of the computational domain wherein the boat is still and the fluid moves with certain conditions imposed at the domain boundaries. In this particular case the upstream region includes a rectangular inlet buffer with a fixed free-stream velocity of 2 m/s, fixed water depth of 1.2 m, and fluid density interpolated from the ghost nodes. The same boundary conditions apply for the outlet area except for the density, which is extrapolated from the ghost nodes. Finally, the bottom and sides of the rectangular domain are discretized by dynamic boundary particles, thus a no-slip condition is enforced. The hull is imported into GenCase using the file _Hull.vtk_ provided in the test case folder, by invoking the command <strong>drawfilevtk file="Hull.vtk"</strong>. The total number of SPH particles is approximately 4×10<sup>5</sup>.


<p align="center">
<img src="https://i.imgur.com/nDnRuIP.png" />
</p>

<p align="center">
<strong>Figure 12-X17.</strong> Simulation of flow past a boat hull using inlet/outlet buffer in three dimensions.
</p>