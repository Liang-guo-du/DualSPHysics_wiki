Some demonstration cases are included in the DualSPHysics package (Figure 12.1); such as a dam break interacting with an obstacle in a tank, waves on a beach created by a piston or the real geometry of a pump mechanism that translates water within a storage tank.

<p align="center">
<img src="link" />
</p>

<p align="center">
<strong>Figure 12-X.</strong> TEXT
</p>

The different test cases are described in the following sections. The scripts (.bat in Windows and .sh in Linux) are presented and the different command line instructions to execute the different programs are described. The XML files are also explained in detail to describe the execution parameters and the different labels to plot boundaries, fluid volumes, movements, etc. 

For each case there are 4 options; 
wCase_win64_CPU.bat (windows on CPU)
wCase_win64_GPU.bat (windows on GPU)
xCase_linux64_CPU.sh (linux on CPU)
xCase_linux64_GPU.sh (linux on GPU)

Since many 3-D applications can be reduced to a 2-D problem, the executable of DualSPHysics can also perform 2-D simulations, however this option is not fully optimized. A 2-D simulation can be achieved easily by imposing the same values in the Y-direction (<pointmin> = <pointmax> in the input XML file). For example, see the two-dimensional 01_DamBreak indicated in Figure 12-2. Thus, the initial configuration is a 2-D system and DualSPHysics will detect automatically that the simulation must be carried out using the 2-D formulation.

 
The different CASES provided are intended as worked examples for users to create their own cases, to learn the different available options and what post-processing tools can be used. The following list summarises the testcases that can be found in examples/main:

01_DAMBREAK
•	3-D dam break flow impacting on a structure: numerical velocity, pressure and force are computed.
•	2-D dam break and validation data from [Koshizula and Oka, 1996] experiment.

02_PERIODICITY
•	2-D case with Periodicity in X direction. 
Delta-SPH is also used.

03_MOVINGSQUARE
•	2-D case with square that moves with rectilinear movement.
Example of no gravity so parameter “b” needs to be specified by the user. 
Shifting is used for this internal flow (no need to detect free surface).

04_EXTERNALFORCES
•	External acceleration is loaded from a file and applied to two different volumes of fluid.
Delta-SPH is also used.

05_SLOSHINGTANK
•	2-D sloshing tank that reads external acceleration from a file.
•	2-D sloshing tank that reads the rotational movement of the tank itself from a file.
Validation with SPHERIC Benchmark #10 where pressure is computed.

06_WAVEMAKER
•	3-D tank with Periodicity in Y direction and piston with sinusoidal movement. 
Delta-SPH and Shifting are used.

07_WAVEMAKERFILE
•	2-D tank with piston motion loaded from external file and external structure (STL).  
Validation data from CIEMito experiment: numerical computation of wave surface elevation and force exerted onto the wall.

08_WAVESFLAP
•	2-D regular waves generated with flap and comparison with 2nd order wave theory (beach).
•	2-D irregular waves generated with flap and comparison with 2nd order wave theory (beach).

09_WAVESPISTON
•	2-D regular waves with piston and comparison with 2nd order wave theory (beach & damping).
•	2-D irregular waves with piston and comparison with 2nd order wave theory (beach & damping).

10_WAVESPISTONAWAS
•	2-D regular waves generated with piston interacting with a vertical wall with and without AWAS
•	2-D regular waves generated with piston interacting with a trapezoidal dike with and without AWAS
Forces against the wall and dike with and without AWAS are compared.
Overtopping in the case of dike with and without AWAS is also compared.

 
11_FLOATING
•	3-D floating box in a wave tank with Periodicity in Y direction and piston with sinusoidal movement. Delta-SPH is used.
•	2-D falling sphere that uses laminar+SPS viscosity. Validation data from [Fekken, 2004] and [Moyo and Greenhow, 2000].

12_FLOATINGWAVES
•	2-D floating box under the action of non-linear waves in a tank with flap that reads rotational motion from an external file and uses laminar+SPS viscosity. 
Validation data (motions of the box) from [Hadzic et al., 2005].
•	2-D floating box under the action of regular waves in a tank with piston. 
Validation data (motions of the box) from [Ren et al., 2015].

13_PUMP
•	3-D external geometries are imported (STL) and filling algorithm is used.
Rotational movement is imposed.

14_DEM
•	2-D case only with DEM of a ball that impacts with blocks. Example without fluid particles.
•	3-D dam-break and blocks where interaction between blocks and with walls used DEM and properties of materials. Delta-SPH is also used.
•	2-D case with 2000 floating objects that interact in terms of DEM approach.

15_POISEUILLE
•	2-D case of Poiseuille flow with laminar+SPS viscosity and using high resolution 

## 12.1 DAMBREAK

A 2-D dam break can be executed using wCaseDambreakVal2D_win64_GPU.bat (xCaseDambreakVal2D_linux64_GPU.sh in linux), which is the file that summarises the tasks to be carried out using the different codes in a given order: 

<p align="center">
<img src="link" />
</p>

Figure 12-2 shows different instants of the CaseDambreakVal2D simulation. The left frames show the PartFluid_xxxx.vtk (computed with PartVTK) and the right ones show the Slices_xxxx.vtk (obtained with IsoSurface) 

<p align="center">
<img src="link" />
</p>

<p align="center">
<strong>Figure 12-X.</strong> TEXT
</p>

With this example, the experimental data of [Koshizuka and Oka, 1996] can be numerically reproduced. The file EXP_X-DamTipPosition_Koshizula&Oka1996.txt includes the X-position of the tip of the dam for several instants (before the impact with the other wall).  

Numerical gauges (<gauges>) allows the user to compute different magnitudes during the execution of DualSPHysics. In this case, two gauges were created at x=0.2 to compute the water column height evolution and at z=0.03 to compute the X-position of the tip of the dam. The gauges can be also observed in the right panel of Figure 12-2.

The 3-D test case consists of a dam-break flow impacting with a structure inside a numerical tank. No moving boundary particles are involved in this simulation and no movement is defined. This case is executed using wCaseDambreak_win64_GPU.bat (xCaseDambreak_linux64_GPU.sh in linux),

Different instants of the CaseDambreak simulation are shown in Figure 12-3 where the PartFluid_xxxx.vtk of the fluid particles, the CaseDambreak_Box_Dp.vtk and CaseDambreak_Building_Dp.vtk are depicted. 

<p align="center">
<img src="link" />
</p>

<p align="center">
<strong>Figure 12-X.</strong> TEXT
</p>

Using MeasureTool code, numerical velocities have been computed in the list of points described in the file CaseDambreak_PointsVelocity.txt, which are (0.754, 0.31, 0.02), (0.754, 0.31, 0.04) and (0.754, 0.31, 0.06) using information of fluid particles within the kernel interaction. Numerical values of Vx-velocity in the x-direction are shown in Figure 12-4 for these three points.

<p align="center">
<img src="link" />
</p>

<p align="center">
<strong>Figure 12-X.</strong> TEXT
</p>

Pressure values are also computed using MeasureTool in the list of points described in the file CaseDambreak_PointsPressure.txt, which corresponds to locations in the front wall of the structure (Figure 12-5) using information of fluid particles within the kernel interaction. Due to the use of the dynamic boundaries, probes used for measuring quantities should not be placed at the exact position of boundary particles. The forces exerted by the boundary particles create a small gap between them and fluid particles (1.5 times h); as a result, probes placed inside the gap will have a reduced fluid particle population and will produce either an incorrect or no result. To avoid this issue, it is proposed that probes are placed at a distance 1.5h from the boundary positions.

In this example, the PointsPressure_Incorrect probes are placed at the exact position as the boundary particles at the building, while the PointsPressure_Correct probes are placed at a distance of 1.5h (for the default conditions and parameters of the case) from the boundaries. The first probes produce no pressure results as the number of fluid particles for the interpolation is too small, while the second shows the pressure impact by the water flow. 

<p align="center">
<img src="link" />
</p>

<p align="center">
<strong>Figure 12-X.</strong> TEXT
</p>

Note that the probes are not automatically associated with the smoothing length h and their position has to be changed manually if the resolution changes. Also, note that by increasing resolution (i.e. using a smaller “dp”) the gap is reduced.
 
Figure 12-6 shows the pressure computed at the correct numerical probes.  

<p align="center">
<img src="link" />
</p>

<p align="center">
<strong>Figure 12-X.</strong> TEXT
</p>

This case also shows how to compute forces exerted against a structure. In this way the force is computed using ComputeForces as the summation of the acceleration values of the boundary particles that form the front wall of the structure (mk=21) multiplied by mass. Figure 12-7 shows the time series of the numerical force.

<p align="center">
<img src="link" />
</p>

<p align="center">
<strong>Figure 12-X.</strong> TEXT
</p>

In fact, the methodology outlined here was used in for the validation of DualSPHysics presented in [Crespo et al. (2011)].

Finally, an example to use FlowTool is also available in CaseDambreak. Two different domains are defined in the text file CaseDambreak_FileBoxes.txt. Figure 12-8 shows the red domain (RESERVOIR) where the water reservoir was initially created and the green box (TANK) to compute the flow rate in front of the obstacle.  The output VTK files named Boxes_xxxx.vtk are also depicted in Figure 12-8 and the colour corresponds to the domain to which they belong.

<p align="center">
<img src="link" />
</p>

<p align="center">
<strong>Figure 12-X.</strong> TEXT
</p>

FlowTool also creates a CSV file, named ResultFlow.csv. Hence, figure 12-9 represents the outflow of the red domain and the inflow into the green one. 

<p align="center">
<img src="link" />
</p>

<p align="center">
<strong>Figure 12-X.</strong> TEXT
</p>

## 12.2 PERIODICITY
This testcase is an example of periodicity applied to 2-D case where particles that leave the domain through the right wall are introduced through the left wall with the same properties but where the vertical position can change (with an increase of +0.3 in Z-position). wCasePeriodicity.bat (xCasePeriodicity.sh in linux) file summarises the tasks to be carried out using the different codes.

Different instants of the CasePeriodicity simulation are shown in Figure 12-10 where the PartFluid_xxxx.vtk of the fluid particles and the CasePeriodicity_Bound.vtk are depicted.

<p align="center">
<img src="link" />
</p>

<p align="center">
<strong>Figure 12-X.</strong> TEXT
</p>

## 12.3 MOVINGSQUARE

A 2-D case without gravity is simulated. A square box is moving with uniform velocity (<mvrect>) inside the numerical tank – see SPHERIC Benchmark #2. Gravity is set to zero, which means that parameter “b” cannot be automatically computed following equation of state (Eq. 14) and needs to be specified in <constantsdef> (<b value="1.1200e+05" auto="false" />).  The value of “b” is chosen to ensure that the speed of sound, cs, is at least 10 times the maximum particle velocity to maintain weak compressibility, that is vmax, cs ≥ 10 vmax.  Shifting is used for this internal flow to prevent the appearance of voids in the fluid. The case can be also executed without applying shifting to observe the problem of the voids.
wCaseMovingSquare.bat (xCaseMovingSquare.sh in linux) file summarises the tasks to be carried out using the different codes. The same case but without using shifting can be also executed to observe how the voids behind the moving object are not avoided if shifting is not applied.

Different instants of the CaseMovingSquare simulation are shown in Figure 12-11 where the PartFluid_xxxx.vtk of the fluid particles and the Square_xxxx.vtk are depicted.

<p align="center">
<img src="link" />
</p>

<p align="center">
<strong>Figure 12-X.</strong> TEXT
</p>

## 12.4 EXTERNALFORCES

This is a testcase where external forces are applied to the system. The external forces can be loaded from the files CaseForcesData_0.csv and CaseForcesData_1.csv. 

wCaseForces.bat (xCaseForces.sh in linux) file summarises the tasks to be carried out using the different codes.
Figure 12-12 shows the external forces that will be applied to the fluid particles inside the numerical tank. This mimics the effect of a box being accelerated in one direction and rotating around the y-axis.

<p align="center">
<img src="link" />
</p>

<p align="center">
<strong>Figure 12-X.</strong> TEXT
</p>

Different instants of the simulation can be observed in Figure 12-13 where the PartFluid_xxxx.vtk of the fluid particles and the file CaseForces_Dp.vtk are depicted. The colours of the fluid particles correspond to the two different MK values.

<p align="center">
<img src="link" />
</p>

<p align="center">
<strong>Figure 12-X.</strong> TEXT
</p>

## 12.5 SLOSHINGTANK

A 2-D sloshing tank is simulated in two different forms:
a)	CaseSloshingAcc: External acceleration is loaded from the CSV file CaseSloshingAccData.csv and applied to the fluid particles.
b)	CaseSloshingMotion: Rotational movement is applied to the tank using prescribed rotation defined in the text file CaseSloshingMotionData.dat (<mvrotfile>) that contains time and degrees (as shown in Figure 12-14).

<p align="center">
<img src="link" />
</p>

<p align="center">
<strong>Figure 12-X.</strong> TEXT
</p>

wCaseSloshing.bat (xCaseSloshing.sh in linux) file summarises the tasks to be carried out using the different codes for the two cases. Different instants of the simulation can be observed in Figure 12-15 where the files PartAll_xxxx.vtk are depicted.

<p align="center">
<img src="link" />
</p>

<p align="center">
<strong>Figure 12-X.</strong> TEXT
</p>

Validation with SPHERIC Benchmark #10 is also included. Experimental pressure is available in EXP_Pressure_SPHERIC_Benchmark#10.txt. Numerical pressures are computed using MeasureTool in both cases. CaseSloshingAcc reads a text file with the fixed position (-0.45, 0, 0.093) while CaseSloshingMotion reads a CSV file with the position of the sensor at each time since the point to measure also moves with the tank. 

Hence, numerical pressure is computed at the location of the experimental sensor (PointsPressure_Incorrect) and at a distance of 1.5h from the boundaries (PointsPressure_Correct) as shown in Figure 12-16. The first probe produces no pressure results as the number of fluid particles for the interpolation is too small, while the second shows the pressure impact by the water flow. 

<p align="center">
<img src="link" />
</p>

<p align="center">
<strong>Figure 12-X.</strong> TEXT
</p>

Note that the probes are not automatically associated with the smoothing length h and their position has to be changed manually if the resolution (or particle size “dp”) changes. Also, note that by increasing resolution the gap is reduced. Using BoundaryVTK, the user can compute the time history of the position of the moving point initially at 1.5h of the wall to obtain new positions to be used with MeasureTool.

Figure 12-17 shows the numerical pressure computed using MeasureTool in both cases and compared with the experimental signal. Results improve using higher resolution than the one used here.

<p align="center">
<img src="link" />
</p>

<p align="center">
<strong>Figure 12-X.</strong> TEXT
</p>

## 12.6 WAVEMAKER

CaseWavemaker simulates several waves breaking on a numerical beach. A wavemaker is performed to generate and propagate the waves. In this testcase, a sinusoidal movement (<mvrectsinu>) is imposed to the boundary particles of the wavemaker and Periodicty in Y direction is also used. wCaseWavemaker.bat (xCaseWavemaker.sh in linux) file describes the execution task to be carried out in this directory.

The files MotionPiston_xxxx.vtk containing the position of the wavemaker at different instants and Surface_xxxx.vtk containing the surface representation are used to display the results in Figure 12-18:

<p align="center">
<img src="link" />
</p>

<p align="center">
<strong>Figure 12-X.</strong> TEXT
</p>

Using the MeasureTool code, numerical wave elevations have been computed in the list of points described in the file CaseWavemaker_PointsHeights.txt. So that, PointsHeights_h_xxxx.vtk are now depicted in Figure 12-19.

<p align="center">
<img src="link" />
</p>

<p align="center">
<strong>Figure 12-X.</strong> TEXT
</p>

MeasureTool is also used to compute the wave elevation at one wave gauge located at x=1, y=1 (CaseWavemaker_wg0_3D.txt) and the output result can be analysed in WG0_Height.csv.

## 12.7 WAVEMAKERFILE

This 2-D case aims to mimic an experiment performed in CIEMito wave flume at the Universitat Politècnica de Catalunya (UPC) in Barcelona. The movement of the piston is prescribed in the file CaseWavemaker2D_Piston_Movement.dat (<mvfile>) and an external structure is loaded (CaseWavemaker2D_Structure.stl). 
The wCaseWavemaker2D.bat (xCaseWavemaker2D.sh in linux) file describes the execution tasks to be carried out in this directory.  

Different instants of the CaseWavemaker2D simulation are shown in Figure 12-20 where the PartFluid_xxxx.vtk of the fluid particles and the PartMoving_xxxx.vtk of the piston are depicted.

<p align="center">
<img src="link" />
</p>

<p align="center">
<strong>Figure 12-X.</strong> TEXT
</p>

This case also includes validation data from the CIEMito experiment: wave surface elevation at different locations (CaseWavemaker2D_wg1_2D.txt, CaseWavemaker2D_wg2_2D.txt and CaseWavemaker2D_wg3_2D.txt) and force exerted onto the right wall. 

Figure 12-21 shows the experiment and numerical time series of wave surface elevation at wg1 obtained using MeasureTool.

<p align="center">
<img src="link" />
</p>

<p align="center">
<strong>Figure 12-X.</strong> TEXT
</p>

This case also computes forces exerted against the structure in the final of the tank. The force is computed using ComputeForces as the summation of the acceleration values of the boundary particles that form the front wall (id:1616-1669) multiplied by mass. Figure 12-22 shows the time series of the numerical force. Note that initial hydrostatic force is 20.72 N (the initial depth in front of the wall is 0.065 m)

<p align="center">
<img src="link" />
</p>

<p align="center">
<strong>Figure 12-X.</strong> TEXT
</p>

12.8 WAVESFLAP

Several examples of automatic generation of waves are included in the new package: monochromatic (regular) waves and irregular waves are generated using flap- and piston-type wavemakers. 

Second-order waves are simulating (Figure 12-23), corresponding to results shown in [Altomare et al., 2017]. The wave height, wave period, water depth at wave generation, wave steepness and wavelength are summarised in the following table. The quantities H and T refer to the wave height and wave period of the first-order component of the monochromatic waves; Hm0 and Tp are the significant wave height and peak wave period of the irregular wave train, respectively.

<p align="center">
<img src="link" />
</p>

<p align="center">
<strong>Figure 12-X.</strong> TEXT
</p>

This first testcase includes wave generation using FLAP. 
wCaseFlapBeach_REG.bat (xCaseFlapBeach_REG.sh in linux) file describes the execution tasks to be carried out in this directory to create monochromatic waves (<flap>). In order to reproduce only incident waves, passive absorption is used here to prevent reflection. In this case the passive absorption consists of a dissipative beach at the end of the tank. 

Different instants of the CaseFlapBeach_REG simulation are shown in Figure 12-24 where the PartFluid_xxxx.vtk of the fluid particles and the PartFlap_xxxx.vtk of the flap are depicted.

<p align="center">
<img src="link" />
</p>

<p align="center">
<strong>Figure 12-X.</strong> TEXT
</p>

Numerical results using MeasureTool are compared with theoretical ones (that can also be computed by DualSPHysics using option <savemotion> in the XML configuration). Figure 12-25 shows the comparison of numerical water surface elevation measured (at a distance of 6 m of the piston) and numerical vertical and horizontal velocity (at 6 m of the piston and 0.26 m from still water level) with the theoretical results using second-order solutions. Note that numerical results agree with second-order theory, which validates the correct generation and propagation using DualSPHysics using flap.

<p align="center">
<img src="link" />
</p>

<p align="center">
<strong>Figure 12-X.</strong> TEXT
</p>

The second case computes the movement of a piston to generate irregular. A pre-defined JONSWAP spectrum is used to characterised the irregular wave train in the frequency domain (<flap_spectrum>). 

wCaseFlapBeach_IRREG.bat (xCaseFlapBeach_IRREG.sh in linux) file describes the execution tasks to be carried out in this directory to create irregular random waves.

Figure 12-26 also shows the comparison of numerical wave surface elevation and horizontal velocity (obtained with MeasureTool) with the theoretical solution (using <savemotion>). Good agreement is also observed for irregular waves. Only first-order wave generation for irregular waves is implemented for flap-type wavemaker. Therefore, possible differences between the numerical and theoretical results are expected. Yet, in the case shown in Figure 12-26 these differences are negligible.

<p align="center">
<img src="link" />
</p>

<p align="center">
<strong>Figure 12-X.</strong> TEXT
</p>

The file “CaseFlap_SPHvsTheory.ods” includes all these comparisons.

12.9 WAVESPISTON

The same wave condition shown in Figure 12-23 is now created using a piston-type wavemaker. Regular (<piston>) and random (<piston_spectrum>) waves are created. Two different passive absorption systems are used to avoid reflection at the end of the tank; a dissipative beach and a sponge layer or damping (<damping>).
Therefore, different scripts can be used here:
-	wCasePistonBeach_REG.bat (xCasePistonBeach_REG.sh in linux)
-	wCasePistonBeach_IRREG.bat (xCasePistonBeach_IRREG.sh in linux)
-	wCasePistonDamping_REG.bat (xCasePistonDamping_REG.sh in linux)
-	wCasePistonDamping_IRREG.bat (xCasePistonDamping_IRREG.sh in linux)

Different instants of the CasePistonBeach_REG simulation are shown in Figure 12-27 where the PartFluid_xxxx.vtk of the fluid particles and the PartPiston_xxxx.vtk of the piston are depicted.

<p align="center">
<img src="link" />
</p>

<p align="center">
<strong>Figure 12-X.</strong> TEXT
</p>

Note how the same instants are shown in the images of Figure 12-27 (using piston) and the images of Figure 12-24 (using flap), and it can be observed how the same waves are created using both wavemakers. Figure 12-28 proves the similar behaviour of both passive absorption systems in the case of regular waves; dissipative beach and sponge layer (damping). Same behaviour is obtained for the irregular tests.

<p align="center">
<img src="link" />
</p>

<p align="center">
<strong>Figure 12-X.</strong> TEXT
</p>

Figure 12-29 shows the comparison of numerical wave surface elevation measured (at a distance of 6 m of the piston) and numerical vertical and horizontal velocity (at 6 m of the piston and 0.26 m from still water level) with the theoretical result using second-order solutions for the case of regular waves. Note that numerical results agree with second-order theory, which validates the correct generation and propagation using DualSPHysics using piston (as shown in [Altomare et al., 2017]). 

<p align="center">
<img src="link" />
</p>

<p align="center">
<strong>Figure 12-X.</strong> TEXT
</p>






































